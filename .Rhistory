pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
group_by(name, surveyYear) %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name), names_to = "surveyYear", values_to = "n")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
group_by(name, surveyYear) %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name), names_to = "surveyYear", values_to = "n")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
group_by(name, surveyYear) %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") #%>%
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
group_by(name, surveyYear) %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded), names_to = "surveyYear", values_to = "n")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
group_by(name, surveyYear) %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded = 1 & n > 0, 1, 0))
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
group_by(name, surveyYear) %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0))
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
group_by(name, surveyYear) %>%
summarise(total = sum(n, na.rm = TRUE), .groups = "keep")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
pivot_longer(-name, names_to = "surveyYear", values_to = "n")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) #%>%
pivot_longer(-c(name, plot), names_to = "surveyYear", values_to = "n")
pivot_longer(-c("name", "plot"), names_to = "surveyYear", values_to = "n")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
pivot_wider(names_from = "surveyYear", values_from = "n")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(name, plot), names_to = "surveyYear", values_to = "n")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(name, plot), names_to = "surveyYear", values_to = "n") %>%
group_by(name, surveyYear) %>%
summarise(total = sum(n, na.rm = TRUE), .groups = "keep")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
#pivot_wider(names_from = "surveyYear", values_from = "n") %>%
#pivot_longer(-c(name, plot), names_to = "surveyYear", values_to = "n") %>%
group_by(name, surveyYear) %>%
summarise(total = sum(n, na.rm = TRUE), .groups = "keep")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
#pivot_wider(names_from = "surveyYear", values_from = "n") %>%
#pivot_longer(-c(name, plot), names_to = "surveyYear", values_to = "n") %>%
group_by(name, surveyYear) %>%
summarise(total = sum(n, na.rm = TRUE), total2 = sum(seeded, na.rm = TRUE) .groups = "keep")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
#pivot_wider(names_from = "surveyYear", values_from = "n") %>%
#pivot_longer(-c(name, plot), names_to = "surveyYear", values_to = "n") %>%
group_by(name, surveyYear) %>%
summarise(total = sum(n, na.rm = TRUE), total2 = sum(seeded, na.rm = TRUE), .groups = "keep")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
#pivot_wider(names_from = "surveyYear", values_from = "n") %>%
#pivot_longer(-c(name, plot), names_to = "surveyYear", values_to = "n") %>%
group_by(name, surveyYear) %>%
summarise(
total_established = sum(n, na.rm = TRUE),
total_seeded = sum(seeded, na.rm = TRUE),
.groups = "keep"
)
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
#pivot_wider(names_from = "surveyYear", values_from = "n") %>%
#pivot_longer(-c(name, plot), names_to = "surveyYear", values_to = "n") %>%
group_by(name, surveyYear) %>%
summarise(
total_established = sum(n, na.rm = TRUE),
total_seeded = sum(seeded, na.rm = TRUE),
.groups = "keep"
) %>%
mutate(rate = total_established / total_seeded)
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
#pivot_wider(names_from = "surveyYear", values_from = "n") %>%
#pivot_longer(-c(name, plot), names_to = "surveyYear", values_to = "n") %>%
group_by(name, surveyYear) %>%
summarise(
total_established = sum(n, na.rm = TRUE),
total_seeded = sum(seeded, na.rm = TRUE),
.groups = "keep"
) %>%
filter(total_seeded > 0) %>%
mutate(rate = total_established / total_seeded,
rate = round(rate, digits = 2))
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
group_by(name, surveyYear) %>%
summarise(
total_established = sum(n, na.rm = TRUE),
total_seeded = sum(seeded, na.rm = TRUE),
.groups = "keep"
) %>%
filter(total_seeded > 0) %>%
mutate(rate = total_established / total_seeded,
rate = round(rate, digits = 2)) %>%
pivot_wider(names_from = "surveyYear". values_from = "n")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
group_by(name, surveyYear) %>%
summarise(
total_established = sum(n, na.rm = TRUE),
total_seeded = sum(seeded, na.rm = TRUE),
.groups = "keep"
) %>%
filter(total_seeded > 0) %>%
mutate(rate = total_established / total_seeded,
rate = round(rate, digits = 2)) %>%
pivot_wider(names_from = "surveyYear", values_from = "n")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
group_by(name, surveyYear) %>%
summarise(
total_established = sum(n, na.rm = TRUE),
total_seeded = sum(seeded, na.rm = TRUE),
.groups = "keep"
) %>%
filter(total_seeded > 0) %>%
mutate(rate = total_established / total_seeded,
rate = round(rate, digits = 2)) %>%
pivot_wider(names_from = "surveyYear", values_from = "rate")
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
group_by(name, surveyYear) %>%
summarise(
total_established = sum(n, na.rm = TRUE),
total_seeded = sum(seeded, na.rm = TRUE),
.groups = "keep"
) %>%
filter(total_seeded > 0) %>%
mutate(rate = total_established / total_seeded,
rate = round(rate, digits = 2)) %>%
pivot_wider(names_from = "surveyYear", values_from = c("rate", "total_seeded"))
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
group_by(name, surveyYear) %>%
summarise(
total_established = sum(n, na.rm = TRUE),
total_seeded = sum(seeded, na.rm = TRUE),
.groups = "keep"
) %>%
filter(total_seeded > 0) %>%
mutate(rate = total_established / total_seeded,
rate = round(rate, digits = 2)) %>%
pivot_wider(names_from = "surveyYear",
values_from = c("rate", "total_seeded", "total_established"))
data <- species %>%
select(-starts_with("C")) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
left_join(sites, by = "id") %>%
mutate(n = if_else(n > 0 & surveyYear == "seeded", 1, n)) %>%
select(plot, name, surveyYear, n) %>%
pivot_wider(names_from = "surveyYear", values_from = "n") %>%
pivot_longer(-c(plot, name, seeded),
names_to = "surveyYear", values_to = "n") %>%
mutate(n = if_else(seeded == 1 & n > 0, 1, 0)) %>%
group_by(name, surveyYear) %>%
summarise(
total_established = sum(n, na.rm = TRUE),
total_seeded = sum(seeded, na.rm = TRUE),
.groups = "keep"
) %>%
filter(total_seeded > 0) %>%
mutate(rate = total_established / total_seeded,
rate = round(rate, digits = 2)) %>%
pivot_wider(names_from = "surveyYear",
values_from = c("rate", "total_seeded", "total_established")) %>%
select(-total_seeded_2019, -total_seeded_2020, -total_seeded_2021)
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
### Start ###
rm(list = ls())
setwd(here("data", "processed"))
### Load data ###
establishment <- read_csv("data_processed_traits.csv",
col_names = TRUE, na = "na", col_types =
cols(
.default = "d",
name = "f"
)) %>%
select(name, estRate1Design, estRate1Standard)
### Load data ###
establishment <- read_csv("data_processed_traits.csv",
col_names = TRUE, na = "na", col_types =
cols(
.default = "d",
name = "f"
)) %>%
select(name, estRate1Design, estRate1Standard)
### Packages ###
library(here)
library(tidyverse)
library(lubridate)
library(naniar) #are_na
library(vegan)
library(adespatial)
library(FD) #dbFD
#remotes::install_github(file.path("inbo", "checklist"))
### Start ###
#installr::updateR(browse_news = FALSE, install_R = TRUE, copy_packages = TRUE, copy_Rprofile.site = TRUE, keep_old_packages = TRUE, update_packages = TRUE, start_new_R = TRUE, quit_R = TRUE, print_R_versions = TRUE, GUI = FALSE)
#checklist::setup_source()
#checklist::check_source()
#renv::snapshot()
rm(list = ls())
setwd(here("data", "raw"))
#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# A Load data ##################################################################
#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
## 1 Sites #####################################################################
sites <- read_csv("data_raw_sites.csv", col_names = TRUE,
na = c("", "NA", "na"),
col_types =
cols(
.default = "f",
surveyDate_seeded = col_date(format = "%Y-%m-%d"),
surveyDate_2018 = col_date(format = "%Y-%m-%d"),
surveyDate_2019 = col_date(format = "%Y-%m-%d"),
surveyDate_2020 = col_date(format = "%Y-%m-%d"),
surveyDate_2021 = col_date(format = "%Y-%m-%d"),
botanist_2018 = "c",
botanist_2019 = "c",
botanist_2020 = "c",
botanist_2021 = "c",
vegetationCov_2018 = "c",
vegetationCov_2019 = "c",
vegetationCov_2020 = "c",
vegetationCov_2021 = "c",
bioMass_2019 = "c"
)) %>%
pivot_longer(starts_with("vegetationCov_") |
starts_with("botanist_") |
starts_with("bioMass_") |
starts_with("surveyDate"),
names_to = c("x", "surveyYear"), names_sep = "_",
values_to = "n", values_transform = list (n = as.character)) %>%
pivot_wider(names_from = "x", values_from = "n") %>%
mutate(plot = str_replace(plot, "-", "_"),
plot = str_replace(plot, "L_", "L"),
plot = str_replace(plot, "W_", "W"),
id = str_c(plot, surveyYear, sep = "_"),
plot = factor(plot),
id = factor(id),
vegetationCov = as.numeric(vegetationCov),
bioMass = as.numeric(bioMass)) %>%
filter(!(site == "C" & (surveyYear == "seeded" |
surveyYear == "2018" |
surveyYear == "2019" |
surveyYear == "2020")))
## 2 Species ###################################################################
species <- data.table::fread("data_raw_species_20211112.csv",
sep = ",",
dec = ".",
skip = 0,
header = TRUE,
na.strings = c("", "NA", "na"),
colClasses = list(
character = "name"
)) %>%
### Check that each species occurs at least one time ###
group_by(name) %>%
arrange(name) %>%
select(name, all_of(sites$id)) %>%
mutate(total = sum(c_across(
starts_with("L") | starts_with("W") | starts_with("C")),
na.rm = TRUE),
presence = if_else(total > 0, 1, 0)) %>%
# filter only species which occur at least one time:
filter(presence == 1) %>%
ungroup() %>%
select(name, sort(tidyselect::peek_vars()), -total, -presence) %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0)))
### Create list with species names and their frequency ###
specieslist <- species %>%
mutate(across(where(is.numeric), ~1 * (. != 0))) %>%
mutate(sum = rowSums(across(where(is.numeric)), na.rm = TRUE),
.keep = "unused") %>%
group_by(name) %>%
summarise(sum = sum(sum))
#write_csv(specieslist, here("outputs/tables/specieslist_20220420.csv"))
## 3 Seedmixes #################################################################
seedmixes <- data.table::fread("data_raw_species_20211112.csv",
sep = ",",
dec = ".",
skip = 0,
header = TRUE,
na.strings = c("", "NA", "na"),
colClasses = list(
character = "name"
)) %>%
arrange(name) %>%
select(name, ends_with("seeded")) %>%
filter(name %in% species$name) %>%
select(name, sort(tidyselect::peek_vars())) %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(-name, names_to = "id", values_to = "seeded") %>%
separate(id, c("plot"), sep = "_(?!.*_)",
remove = TRUE, extra = "drop", fill = "warn", convert = FALSE)
## 4 Traits ####################################################################
traits <- read_csv("data_raw_traits.csv", col_names = TRUE,
na = c("", "NA", "na"),
col_types =
cols(
.default = "f",
name = "c",
l = "d",
t = "d",
k = "d",
f = "d",
r = "d",
n = "d",
)) %>%
separate(name, c("genus", "species", "ssp", "subspecies"), "_",
remove = FALSE, extra = "drop", fill = "right") %>%
mutate(genus = str_sub(genus, 1, 4),
species = str_sub(species, 1, 4),
subspecies = str_sub(subspecies, 1, 4),
name = as.character(name)) %>%
unite(abb, genus, species, subspecies, sep = "", na.rm = TRUE) %>%
mutate(abb = str_replace(abb, "NA", ""),
abb = as_factor(abb)) %>%
select(-ssp, -synonym, -nomenclature, -legal, -l, -k, -fchange) %>%
arrange(name)
### Check congruency of traits and species table ###
traits[duplicated(traits$abb), ]
#traits$name[which(!(traits$name %in% species$name))]
species$name[which(!(species$name %in% traits$name))]
traits <- traits %>%
semi_join(species, by = "name")
