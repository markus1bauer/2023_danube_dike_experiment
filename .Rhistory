(1 | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth +
exposition + surveyYear_fac)^2 +
(1 | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth +
exposition + surveyYear_fac + index)^2 +
(1 | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth +
exposition + surveyYear_fac + index)^2 +
(1 | block/plot) + (1 | index),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth +
exposition + surveyYear_fac)^3 +
(1 | block/plot) + (1 | index),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth +
exposition + surveyYear_fac + index)^4 +
(1 | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth +
exposition + surveyYear_fac + index)^5 +
(1 | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth +
exposition + surveyYear_fac + index)^5 +
(1 + surveyYear_fac | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
### Start ###
#rm(list = ls())
setwd(here("data", "processed"))
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE,
na = c("na", "NA", ""), col_types =
cols(
.default = "?",
id = "f",
plot = "f",
block = "f",
exposition = col_factor(levels = c("north", "south")),
sandRatio = "f",
substrateDepth = "f",
targetType = "f",
seedDensity = "f"
)) %>%
filter(
!str_detect(id, "C") &
presabu == "presence" &
surveyYear != "seeded"
) %>%
select(
id, plot, block, exposition, sandRatio, substrateDepth, targetType,
seedDensity, surveyYear, age, B, C
) %>%
pivot_longer(cols = c(B, C), names_to = "index", values_to = "n",
names_transform = as.factor) %>%
mutate(
index = fct_rev(index),
surveyYear = as.double(surveyYear),
surveyYear_fac = as.factor(surveyYear)
)
### a Graphs -----------------------------------------------------------------
#simple effects:
ggplot(sites %>% filter(surveyYear == 2021, index == "B"),
aes(y = n, x = exposition)) +
geom_boxplot() + geom_quasirandom() #
ggplot(sites %>% filter(surveyYear == 2021, index == "B"),
aes(y = n, x = block)) +
geom_boxplot() + geom_quasirandom()
#2way
ggplot(sites %>% filter(surveyYear == 2021, index == "B"),
aes(x = targetType, y = n)) +
geom_boxplot() + geom_quasirandom() +
facet_wrap(~ exposition)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth +
exposition + surveyYear_fac + index)^3 +
(1 + surveyYear_fac | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth) *
(exposition + surveyYear_fac + index)^3 +
(1 | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
View(sites)
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE,
na = c("na", "NA", ""), col_types =
cols(
.default = "?",
id = "f",
plot = "f",
block = "f",
exposition = col_factor(levels = c("north", "south")),
sandRatio = "f",
substrateDepth = "f",
targetType = "f",
seedDensity = "f"
)) #%>%
View(sites)
filter(
!str_detect(id, "C") &
presabu == "presence" &
surveyYear != "seeded"
) %>%
select(
id, plot, block, exposition, sandRatio, substrateDepth, targetType,
seedDensity, surveyYear, age, B, C
) %>%
pivot_longer(cols = c(B, C), names_to = "index", values_to = "n",
names_transform = as.factor) %>%
mutate(
index = fct_rev(index),
surveyYear = as.double(surveyYear),
surveyYear_fac = as.factor(surveyYear),
botanist_year = str_c(botanist, surveyYear)
)
filter(
!str_detect(id, "C") &
presabu == "presence" &
surveyYear != "seeded"
) %>%
select(
id, plot, block, exposition, sandRatio, substrateDepth, targetType,
seedDensity, surveyYear, age, B, C
) %>%
pivot_longer(cols = c(B, C), names_to = "index", values_to = "n",
names_transform = as.factor) %>%
mutate(
index = fct_rev(index),
botanist_year = str_c(botanist, surveyYear)
surveyYear = as.double(surveyYear),
surveyYear_fac = as.factor(surveyYear),
)
filter(
!str_detect(id, "C") &
presabu == "presence" &
surveyYear != "seeded"
) %>%
select(
id, plot, block, exposition, sandRatio, substrateDepth, targetType,
seedDensity, surveyYear, age, B, C
) %>%
pivot_longer(cols = c(B, C), names_to = "index", values_to = "n",
names_transform = as.factor) %>%
mutate(
index = fct_rev(index),
botanist_year = str_c(botanist, surveyYear),
surveyYear = as.double(surveyYear),
surveyYear_fac = as.factor(surveyYear)
)
filter(
!str_detect(id, "C") &
presabu == "presence" &
surveyYear != "seeded"
) %>%
select(
id, plot, block, exposition, sandRatio, substrateDepth, targetType,
seedDensity, surveyYear, age, B, C
) %>%
pivot_longer(cols = c(B, C), names_to = "index", values_to = "n",
names_transform = as.factor) #%>%
filter(
!str_detect(id, "C") &
presabu == "presence" &
surveyYear != "seeded"
) %>%
select(
id, plot, block, exposition, sandRatio, substrateDepth, targetType,
seedDensity, surveyYear, age, B, C
) %>%
pivot_longer(cols = c(B, C), names_to = "index", values_to = "n",
names_transform = as.factor) #%>%
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE,
na = c("na", "NA", ""), col_types =
cols(
.default = "?",
id = "f",
plot = "f",
block = "f",
exposition = col_factor(levels = c("north", "south")),
sandRatio = "f",
substrateDepth = "f",
targetType = "f",
seedDensity = "f"
)) %>%
filter(
!str_detect(id, "C") &
presabu == "presence" &
surveyYear != "seeded"
) %>%
select(
id, plot, block, exposition, sandRatio, substrateDepth, targetType,
seedDensity, surveyYear, age, B, C
) %>%
pivot_longer(cols = c(B, C), names_to = "index", values_to = "n",
names_transform = as.factor) #%>%
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE,
na = c("na", "NA", ""), col_types =
cols(
.default = "?",
id = "f",
plot = "f",
block = "f",
exposition = col_factor(levels = c("north", "south")),
sandRatio = "f",
substrateDepth = "f",
targetType = "f",
seedDensity = "f"
)) %>%
filter(
!str_detect(id, "C") &
presabu == "presence" &
surveyYear != "seeded"
) %>%
select(
id, plot, block, exposition, sandRatio, substrateDepth, targetType,
seedDensity, surveyYear, age, B, C
) %>%
pivot_longer(cols = c(B, C), names_to = "index", values_to = "n",
names_transform = as.factor) %>%
mutate(
index = fct_rev(index),
botanist_year = str_c(botanist, surveyYear),
surveyYear = as.double(surveyYear),
surveyYear_fac = as.factor(surveyYear)
)
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE,
na = c("na", "NA", ""), col_types =
cols(
.default = "?",
id = "f",
plot = "f",
block = "f",
exposition = col_factor(levels = c("north", "south")),
sandRatio = "f",
substrateDepth = "f",
targetType = "f",
seedDensity = "f"
)) %>%
filter(
!str_detect(id, "C") &
presabu == "presence" &
surveyYear != "seeded"
) %>%
pivot_longer(cols = c(B, C), names_to = "index", values_to = "n",
names_transform = as.factor) %>%
mutate(
index = fct_rev(index),
botanist_year = str_c(botanist, surveyYear),
surveyYear = as.double(surveyYear),
surveyYear_fac = as.factor(surveyYear)
) %>%
select(
id, plot, block, exposition, sandRatio, substrateDepth, targetType,
seedDensity, surveyYear, age, index, n, botanist_year
)
View(sites)
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE,
na = c("na", "NA", ""), col_types =
cols(
.default = "?",
id = "f",
plot = "f",
block = "f",
exposition = col_factor(levels = c("north", "south")),
sandRatio = "f",
substrateDepth = "f",
targetType = "f",
seedDensity = "f"
)) %>%
filter(
!str_detect(id, "C") &
presabu == "presence" &
surveyYear != "seeded"
) %>%
pivot_longer(cols = c(B, C), names_to = "index", values_to = "n",
names_transform = as.factor) %>%
mutate(
index = fct_rev(index),
botanist_year = str_c(botanist, surveyYear),
surveyYear = as.double(surveyYear),
surveyYear_fac = as.factor(surveyYear)
) %>%
select(
id, plot, site, block, exposition, sandRatio, substrateDepth, targetType,
seedDensity, surveyYear, age, index, n, botanist_year
)
### a Graphs -----------------------------------------------------------------
#simple effects:
ggplot(sites %>% filter(surveyYear == 2021, index == "B"),
aes(y = n, x = exposition)) +
geom_boxplot() + geom_quasirandom() #
ggplot(sites %>% filter(surveyYear == 2021, index == "B"),
aes(y = n, x = block)) +
geom_boxplot() + geom_quasirandom()
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth) *
(surveyYear_fac + index)^2 +
(1 | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE,
na = c("na", "NA", ""), col_types =
cols(
.default = "?",
id = "f",
plot = "f",
block = "f",
exposition = col_factor(levels = c("north", "south")),
sandRatio = "f",
substrateDepth = "f",
targetType = "f",
seedDensity = "f"
)) %>%
filter(
!str_detect(id, "C") &
presabu == "presence" &
surveyYear != "seeded"
) %>%
pivot_longer(cols = c(B, C), names_to = "index", values_to = "n",
names_transform = as.factor) %>%
mutate(
index = fct_rev(index),
botanist_year = str_c(botanist, surveyYear),
surveyYear = as.double(surveyYear),
surveyYear_fac = as.factor(surveyYear)
) %>%
select(
id, plot, site, block, exposition,
sandRatio, substrateDepth, targetType, seedDensity,
surveyYear, age, botanist_year, surveyYear_fac,
index, n
)
#2way
ggplot(sites %>% filter(surveyYear == 2021, index == "B"),
aes(x = targetType, y = n)) +
geom_boxplot() + geom_quasirandom() +
facet_wrap(~ exposition)
ggplot(sites %>% filter(surveyYear == 2021, index == "B"),
aes(x = sandRatio, y = n)) +
geom_boxplot() + geom_quasirandom() +
facet_wrap(~ exposition)
ggplot(sites %>% filter(surveyYear == 2021, index == "B"),
aes(x = substrateDepth, y = n)) +
geom_boxplot() + geom_quasirandom() +
facet_wrap(~ exposition)
ggplot(sites %>% filter(surveyYear == 2021, index == "B"),
aes(x = seedDensity, y = n)) +
geom_boxplot() + geom_quasirandom() +
facet_wrap(~ exposition) #
#3way
ggplot(sites %>% filter(surveyYear == 2021, index == "B"),
aes(x = sandRatio, y = n, color = substrateDepth)) +
geom_boxplot() + geom_quasirandom(dodge.width = .8, alpha = .5) +
facet_wrap(~ exposition)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth) *
(surveyYear_fac + index)^2 +
(1 | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth) *
(surveyYear_fac + index + exposition)^3 +
(1 | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth) *
(surveyYear_fac + index + exposition)^3 +
(age | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth) *
(index + exposition)^3 +
(age | block/plot),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth) *
(surveyYear_fac + index + exposition)^3 +
(1 | block/plot) + (1 | botanist_year),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth) *
(surveyYear_fac + index + exposition)^3 +
(1 | site/plot) + (1 | botanist_year),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth) *
(surveyYear_fac + index + exposition)^3 +
(1 | block/substrateDepth/sandRatio/plot) +
(1 | botanist_year),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth) *
(surveyYear_fac + index + exposition)^3 +
(1 | block/substrateDepth/plot) +
(1 | botanist_year),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
m4 <- lmerTest::lmer(n ~ (targetType + seedDensity +
sandRatio + substrateDepth) *
(surveyYear_fac + index + exposition)^3 +
(1 | block/plot) +
(1 | botanist_year),
data = sites,
REML = FALSE);lme4::isSingular(m4);simulateResiduals(m4, plot = TRUE);car::Anova(m4, type = 2)
iter = 10000
chains = 4
thin = 2
m3 <- brm(n ~ (targetType + seedDensity +
sandRatio + substrateDepth) *
(surveyYear_fac + index + exposition)^3 +
(1 | block/plot) +
(1 | botanist_year),
data = sites,
family = gaussian("identity"),
prior = c(
set_prior("normal(0, 0.6)", class = "b"),
set_prior("cauchy(0, 1)", class = "sigma")
),
chains = chains,
iter = iter,
thin = thin,
#control = list(adapt_delta = 0.99, max_treedepth = 12),
warmup = floor(iter / 2),
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = 123)
m_2 <- m3
bayes_R2(m_2, probs = c(0.05, 0.5, 0.95),
re_formula =  ~ (1 | block/plot) + (1 | botanist_year))
bayes_R2(m_2, probs = c(0.05, 0.5, 0.95),
re_formula = 1 ~ 1)
createDHARMa(
simulatedResponse = t(posterior_predict(m_2)),
observedResponse = sites$n,
fittedPredictedResponse = apply(t(posterior_epred(m_2)), 1, mean),
integerResponse = TRUE
) %>%
plot()
posterior2 <- m_2 %>%
posterior::as_draws() %>%
posterior::subset_draws(
variable = c(
"b_substrateDepth30",
"b_seedDensity8",
"b_targetTypedry_grassland",
"b_sandRatio25",
"b_sandRatio50",
"b_expositionsouth",
"sd_block__Intercept",
"sd_block:plot__Intercept",
"sigma"
)
)
hmc_diagnostics2 <- nuts_params(m_2)
y <- sites$n
yrep1 <- posterior_predict(m_1, draws = 500)
yrep2 <- posterior_predict(m_2, draws = 500)
loo2 <- loo(m_2, save_psis = TRUE, moment_match = FALSE)
draws2 <- m_2 %>%
posterior::as_draws() %>%
posterior::summarize_draws() %>%
filter(str_starts(variable, "b_"))
range(draws2$rhat)
range(draws2$ess_bulk)
range(draws2$ess_tail)
mcmc_trace(posterior2, np = hmc_diagnostics2)
mcmc_pairs(posterior2, off_diag_args = list(size = 1.2))
mcmc_scatter(m_2,
pars = c("b_surveyYear_fac2020", "b_surveyYear_fac2019"),
np = hmc_diagnostics2,
size = 1)
mcmc_parcoord(posterior2, np = hmc_diagnostics2)
