),
sd_reference = if_else(
exposition == "north" & target_type == "dry_grassland", 0.259, if_else(
exposition == "north" & target_type == "hay_meadow", 0.212, if_else(
exposition == "south" & target_type == "dry_grassland", 0.298,
if_else(
exposition == "south" & target_type == "hay_meadow", 0.173, NA_real_
)
)
)
),
recovery_time = NMDS1 - mean_reference
)
rm(list = setdiff(ls(), c(
"sites_experiment", "sites_splot", "sites_bauer", "sites_nmds",
"species_experiment", "species_splot", "species_bauer",
"traits", "results.classification"
)))
write_csv(
sites_nmds,
here("data", "processed", "data_processed_sites_nmds.csv")
)
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
library(patchwork)
library(brms)
### Start ###
rm(list = ls())
### Load data ###
sites <- read_csv(here("data", "processed", "data_processed_sites_nmds.csv"),
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
id = "f",
plot = "f",
site = "f",
exposition = col_factor(levels = c("north", "south", "other")),
sand_ratio = "f",
substrate_depth = col_factor(levels = c("30", "15")),
target_type = "f",
seed_density = "f"
)) %>%
filter(reference == "2018" | reference == "2019" | reference == "2020" |
reference == "2021") %>%
mutate(
survey_year_fct = factor(survey_year),
survey_year = as.numeric(survey_year),
botanist_year = str_c(survey_year, botanist, sep = " "),
n = recovery_time
)
rm(list = setdiff(ls(), c("sites")))
plot1 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = sand_ratio)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Sand ratio [vol%] (Data of 2021)")
plot2 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = substrate_depth)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Substrate depth [cm] (Data of 2021)")
plot3 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = target_type)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Target type (Data of 2021)")
plot4 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = seed_density)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Seed density [g/m²] (Data of 2021)")
(plot1 + plot2) / (plot3 + plot4)
plot1 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = exposition)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Exposition (Data of 2021)")
plot2 <- ggplot(sites, aes(y = n, x = survey_year_fct)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Survey year")
plot3 <- ggplot(sites %>% filter(survey_year == 2021), aes(y = n, x = site)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Blocks (Data of 2021)")
plot4 <- ggplot(sites, aes(y = n, x = botanist_year)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Botanists and survey year") +
theme(axis.text.x = element_text(angle = 90))
(plot1 + plot2) / (plot3 + plot4)
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
library(brms)
library(DHARMa)
library(bayesplot)
library(loo)
library(tidybayes)
library(emmeans)
### Start ###
rm(list = ls())
### Load data ###
sites <- read_csv(here("data", "processed", "data_processed_sites_nmds.csv"),
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
id = "f",
plot = "f",
site = "f",
exposition = col_factor(levels = c("north", "south", "other")),
sand_ratio = "f",
substrate_depth = col_factor(levels = c("30", "15")),
target_type = "f",
seed_density = "f"
)) %>%
filter(reference == "2018" | reference == "2019" | reference == "2020" |
reference == "2021") %>%
mutate(
survey_year_fct = factor(survey_year),
survey_year = as.numeric(survey_year),
botanist_year = str_c(survey_year, botanist, sep = " "),
n = recovery_time
)
rm(list = setdiff(ls(), c("sites")))
### Load models ###
save(file = here("outputs", "models", "model_recovery_simple.Rdata"))
save(file = here("outputs", "models", "model_recovery_full.Rdata"))
save(file = here("outputs", "models", "model_recovery_1.Rdata"))
save(file = here("outputs", "models", "model_recovery_2.Rdata"))
save(file = here("outputs", "models", "model_recovery_3.Rdata"))
save(file = here("outputs", "models", "model_recovery_3_flat.Rdata"))
### Load models ###
load(file = here("outputs", "models", "model_recovery_simple.Rdata"))
### Load models ###
base::load(file = here("outputs", "models", "model_recovery_simple.Rdata"))
base::load(file = here("outputs", "models", "model_recovery_full.Rdata"))
base::load(file = here("outputs", "models", "model_recovery_1.Rdata"))
base::load(file = here("outputs", "models", "model_recovery_2.Rdata"))
base::load(file = here("outputs", "models", "model_recovery_3.Rdata"))
base::load(file = here("outputs", "models", "model_recovery_3_flat.Rdata"))
### Load models ###
base::load(file = here("outputs", "models", "model_recovery_time_simple.Rdata"))
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
library(patchwork)
library(brms)
### Start ###
rm(list = ls())
### Load data ###
sites <- read_csv(here("data", "processed", "data_processed_sites_nmds.csv"),
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
id = "f",
plot = "f",
site = "f",
exposition = col_factor(levels = c("north", "south", "other")),
sand_ratio = "f",
substrate_depth = col_factor(levels = c("30", "15")),
target_type = "f",
seed_density = "f"
)) %>%
filter(reference == "2018" | reference == "2019" | reference == "2020" |
reference == "2021") %>%
mutate(
survey_year_fct = factor(survey_year),
survey_year = as.numeric(survey_year),
botanist_year = str_c(survey_year, botanist, sep = " "),
n = recovery_time
)
rm(list = setdiff(ls(), c("sites")))
#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# B Statistics #################################################################
#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
## 1 Data exploration ##########################################################
### a Graphs of raw data -------------------------------------------------------
plot1 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = sand_ratio)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Sand ratio [vol%] (Data of 2021)")
plot2 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = substrate_depth)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Substrate depth [cm] (Data of 2021)")
plot3 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = target_type)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Target type (Data of 2021)")
plot4 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = seed_density)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Seed density [g/m²] (Data of 2021)")
(plot1 + plot2) / (plot3 + plot4)
plot1 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = exposition)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Exposition (Data of 2021)")
plot2 <- ggplot(sites, aes(y = n, x = survey_year_fct)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Survey year")
plot3 <- ggplot(sites %>% filter(survey_year == 2021), aes(y = n, x = site)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Blocks (Data of 2021)")
plot4 <- ggplot(sites, aes(y = n, x = botanist_year)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Botanists and survey year") +
theme(axis.text.x = element_text(angle = 90))
(plot1 + plot2) / (plot3 + plot4)
ggplot(data = sites,
aes(x = sand_ratio, y = n, color = target_type)) +
geom_quasirandom(alpha = 0.5, dodge.width = 0.8) +
geom_boxplot(fill = "transparent") +
facet_grid(exposition ~ survey_year_fct) +
labs(title = "Target type vs. sand ratio [vol%]")
ggplot(data = sites,
aes(x = sand_ratio, y = n, color = substrate_depth)) +
geom_quasirandom(alpha = 0.5, dodge.width = 0.8) +
geom_boxplot(fill = "transparent") +
facet_grid(exposition ~ survey_year_fct) +
labs(title = "Substrate depth [cm] vs. sand ratio [vol%]")
ggplot(data = sites,
aes(x = seed_density, y = n, color = target_type)) +
geom_quasirandom(alpha = 0.5, dodge.width = 0.8) +
geom_boxplot(fill = "transparent") +
facet_grid(exposition ~ survey_year_fct) +
labs(title = "Target type vs. Seed density [g/m²]")
### b Outliers, zero-inflation, transformations? ----------------------------
sites %>% group_by(exposition) %>% count(site)
boxplot(sites$n)
ggplot(sites, aes(x = exposition, y = n)) + geom_quasirandom()
ggplot(sites, aes(x = n)) + geom_histogram(binwidth = 0.03)
ggplot(sites, aes(x = n)) + geom_density()
ggplot(sites, aes(sqrt(n))) + geom_density()
## 2 Model building ###########################################################
### Specifications ###
iter = 10000
chains = 4
thin = 2
priors <- c(
set_prior("normal(0, 2)", class = "b"),
set_prior("normal(0.1, 2)", class = "b", coef = "sand_ratio25"),
set_prior("normal(0.2, 2)", class = "b", coef = "sand_ratio50"),
set_prior("normal(-0.1, 2)", class = "b", coef = "expositionsouth"),
set_prior("normal(0.1, 2)", class = "b", coef = "survey_year_fct2019"),
set_prior("normal(0.2, 2)", class = "b", coef = "survey_year_fct2020"),
set_prior("normal(0.3, 2)", class = "b",coef = "survey_year_fct2021"),
set_prior("cauchy(0, 1)", class = "sigma")
)
### Models ###
m_simple <- brm(n ~ target_type + exposition + sand_ratio + survey_year_fct +
seed_density + substrate_depth +
(1 | site/plot) + (1 | botanist_year),
data = sites,
family = gaussian("identity"),
prior = priors,
chains = chains,
iter = iter,
thin = thin,
warmup = floor(iter / 2),
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = 121)
save(m_simple, file = here("outputs", "models", "model_recovery_simple.Rdata"))
m_full <- brm(n ~ (target_type + exposition + sand_ratio + survey_year_fct +
seed_density + substrate_depth)^3 +
target_type:sand_ratio:exposition:survey_year_fct +
substrate_depth:sand_ratio:exposition:survey_year_fct +
(1 | site/plot) + (1 | botanist_year),
data = sites,
family = gaussian("identity"),
prior = priors,
chains = chains,
iter = iter,
thin = thin,
warmup = floor(iter / 2),
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = 123)
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
library(brms)
library(DHARMa)
library(bayesplot)
library(loo)
library(tidybayes)
library(emmeans)
### Start ###
rm(list = ls())
### Load data ###
sites <- read_csv(here("data", "processed", "data_processed_sites_nmds.csv"),
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
id = "f",
plot = "f",
site = "f",
exposition = col_factor(levels = c("north", "south", "other")),
sand_ratio = "f",
substrate_depth = col_factor(levels = c("30", "15")),
target_type = "f",
seed_density = "f"
)) %>%
filter(reference == "2018" | reference == "2019" | reference == "2020" |
reference == "2021") %>%
mutate(
survey_year_fct = factor(survey_year),
survey_year = as.numeric(survey_year),
botanist_year = str_c(survey_year, botanist, sep = " "),
n = recovery_time
)
rm(list = setdiff(ls(), c("sites")))
### Load models ###
base::load(file = here("outputs", "models", "model_recovery_simple.Rdata"))
base::load(file = here("outputs", "models", "model_recovery_full.Rdata"))
base::load(file = here("outputs", "models", "model_recovery_1.Rdata"))
base::load(file = here("outputs", "models", "model_recovery_2.Rdata"))
base::load(file = here("outputs", "models", "model_recovery_3.Rdata"))
base::load(file = here("outputs", "models", "model_recovery_3_flat.Rdata"))
m_full <- brm(n ~ (target_type + exposition + sand_ratio + survey_year_fct +
seed_density + substrate_depth)^3 +
target_type:sand_ratio:exposition:survey_year_fct +
substrate_depth:sand_ratio:exposition:survey_year_fct +
(1 | site/plot) + (1 | botanist_year),
data = sites,
family = gaussian("identity"),
prior = priors,
chains = chains,
iter = iter,
thin = thin,
warmup = floor(iter / 2),
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = 123)
# Dike grassland field experiment
# Dike grassland field experiment
# Recover time ####
# Model building
# Markus Bauer
# 2022-11-15
#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# A Preparation ###############################################################
#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
library(patchwork)
library(brms)
### Start ###
rm(list = ls())
### Load data ###
sites <- read_csv(here("data", "processed", "data_processed_sites_nmds.csv"),
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
id = "f",
plot = "f",
site = "f",
exposition = col_factor(levels = c("north", "south", "other")),
sand_ratio = "f",
substrate_depth = col_factor(levels = c("30", "15")),
target_type = "f",
seed_density = "f"
)) %>%
filter(reference == "2018" | reference == "2019" | reference == "2020" |
reference == "2021") %>%
mutate(
survey_year_fct = factor(survey_year),
survey_year = as.numeric(survey_year),
botanist_year = str_c(survey_year, botanist, sep = " "),
n = recovery_time
)
rm(list = setdiff(ls(), c("sites")))
#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# B Statistics #################################################################
#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
## 1 Data exploration ##########################################################
### a Graphs of raw data -------------------------------------------------------
plot1 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = sand_ratio)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Sand ratio [vol%] (Data of 2021)")
plot2 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = substrate_depth)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Substrate depth [cm] (Data of 2021)")
plot3 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = target_type)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Target type (Data of 2021)")
plot4 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = seed_density)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Seed density [g/m²] (Data of 2021)")
(plot1 + plot2) / (plot3 + plot4)
plot1 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = exposition)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Exposition (Data of 2021)")
plot2 <- ggplot(sites, aes(y = n, x = survey_year_fct)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Survey year")
plot3 <- ggplot(sites %>% filter(survey_year == 2021), aes(y = n, x = site)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Blocks (Data of 2021)")
plot4 <- ggplot(sites, aes(y = n, x = botanist_year)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Botanists and survey year") +
theme(axis.text.x = element_text(angle = 90))
(plot1 + plot2) / (plot3 + plot4)
ggplot(data = sites,
aes(x = sand_ratio, y = n, color = target_type)) +
geom_quasirandom(alpha = 0.5, dodge.width = 0.8) +
geom_boxplot(fill = "transparent") +
facet_grid(exposition ~ survey_year_fct) +
labs(title = "Target type vs. sand ratio [vol%]")
ggplot(data = sites,
aes(x = sand_ratio, y = n, color = substrate_depth)) +
geom_quasirandom(alpha = 0.5, dodge.width = 0.8) +
geom_boxplot(fill = "transparent") +
facet_grid(exposition ~ survey_year_fct) +
labs(title = "Substrate depth [cm] vs. sand ratio [vol%]")
ggplot(data = sites,
aes(x = seed_density, y = n, color = target_type)) +
geom_quasirandom(alpha = 0.5, dodge.width = 0.8) +
geom_boxplot(fill = "transparent") +
facet_grid(exposition ~ survey_year_fct) +
labs(title = "Target type vs. Seed density [g/m²]")
### b Outliers, zero-inflation, transformations? ----------------------------
sites %>% group_by(exposition) %>% count(site)
boxplot(sites$n)
ggplot(sites, aes(x = exposition, y = n)) + geom_quasirandom()
ggplot(sites, aes(x = n)) + geom_histogram(binwidth = 0.03)
ggplot(sites, aes(x = n)) + geom_density()
ggplot(sites, aes(sqrt(n))) + geom_density()
## 2 Model building ###########################################################
### a Preparation -------------------------------------------------------------
### Posssible priors ###
get_prior(n ~ target_type + exposition + sand_ratio + survey_year_fct +
seed_density + substrate_depth +
(1 | site/plot) + (1 | botanist_year),
data = sites)
### Example of normal distribution
ggplot(data = data.frame(x = c(-2, 2)), aes(x = x)) +
stat_function(fun = dnorm, n = 101, args = list(mean = 0, sd = 2)) +
expand_limits(y = 0)
### Example of cauchy distribution
ggplot(data = data.frame(x = c(-2, 2)), aes(x = x)) +
stat_function(fun = dcauchy, n = 101, args = list(location = 0, scale = 1)) +
expand_limits(y = 0)
### Example of a student t distribution
ggplot(data.frame(x = c(-2, 2)), aes(x = x)) +
stat_function(fun = dstudent_t, args = list(df = 3, mu = 0, sigma = 2.5)) +
expand_limits(y = 0)
### a Models ------------------------------------------------------------------
### Specifications ###
iter = 10000
chains = 4
thin = 2
priors <- c(
set_prior("normal(0, 2)", class = "b"),
set_prior("normal(0.1, 2)", class = "b", coef = "sand_ratio25"),
set_prior("normal(0.2, 2)", class = "b", coef = "sand_ratio50"),
set_prior("normal(-0.1, 2)", class = "b", coef = "expositionsouth"),
set_prior("normal(0.1, 2)", class = "b", coef = "survey_year_fct2019"),
set_prior("normal(0.2, 2)", class = "b", coef = "survey_year_fct2020"),
set_prior("normal(0.3, 2)", class = "b",coef = "survey_year_fct2021"),
set_prior("cauchy(0, 1)", class = "sigma")
)
### Models ###
m_simple <- brm(n ~ target_type + exposition + sand_ratio + survey_year_fct +
seed_density + substrate_depth +
(1 | site/plot) + (1 | botanist_year),
data = sites,
family = gaussian("identity"),
prior = priors,
chains = chains,
iter = iter,
thin = thin,
warmup = floor(iter / 2),
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = 121)
m_full <- brm(n ~ (target_type + exposition + sand_ratio + survey_year_fct +
seed_density + substrate_depth)^3 +
target_type:sand_ratio:exposition:survey_year_fct +
substrate_depth:sand_ratio:exposition:survey_year_fct +
(1 | site/plot) + (1 | botanist_year),
data = sites,
family = gaussian("identity"),
prior = priors,
chains = chains,
iter = iter,
thin = thin,
warmup = floor(iter / 2),
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = 123)
m1 <- brm(n ~ (target_type + exposition + sand_ratio + survey_year_fct)^4 +
substrate_depth + seed_density +
(1 | site/plot) + (1 | botanist_year),
data = sites,
family = gaussian("identity"),
prior = priors,
chains = chains,
iter = iter,
thin = thin,
warmup = floor(iter / 2),
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = 123)
save(m_full, file = here("outputs", "models", "model_recovery_full.Rdata"))
