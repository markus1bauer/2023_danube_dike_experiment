mutate(name = fct_recode(name, Persicaria_amphibia = "Polygonum_amphibium")) %>%
mutate(name = fct_recode(name, Persicaria_bistorta = "Bistorta_officinalis")) %>%
mutate(name = fct_recode(name, Persicaria_minor = "Polygonum_minus")) %>%
mutate(name = fct_recode(name, Silene_latifolia_ssp_alba = "Silene_latifolia")) %>%
mutate(name = fct_recode(name, Silene_latifolia_ssp_alba = "Silene_alba")) %>%
mutate(name = fct_recode(name, "Silene_flos-cuculi" = "Lychnis_flos-cuculi")) %>%
mutate(name = fct_recode(name, Taraxacum_campylodes = "Taraxacum_officinale")) %>%
mutate(name = fct_recode(name, Vicia_sativa_ssp_nigra = "Vicia_angustifolia")) %>%
### combine created duplicates ###
group_by(name) %>%
summarise(across(where(is.double), ~sum(.x, na.rm = T))) %>%
### Implement counted inidviduals as 0.5 % in normal columns ###
mutate(across(where(is.numeric) & contains("i"), ~ 0.5 * (. > 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "n") %>%
mutate(id  =  str_replace(id, "i", "")) %>%
group_by(name, id) %>%
summarise(max = max(n, na.rm = T)) %>%
mutate(max = ifelse(is.infinite(max), NA, max)) %>%
pivot_wider(names_from = "id", values_from = "max") %>%
mutate(name = as_factor(name)) %>%
### Check that each species occurs at least one time ###
group_by(name) %>%
mutate(total = sum(c_across(starts_with("L") | starts_with("W")), na.rm = T)) %>%
mutate(presence = if_else(total > 0, 1, 0)) %>%
filter(presence == 1) %>%
ungroup() %>%
select(-total, -presence) %>%
rename_with(~ str_replace(.x, "_1_201", "_01_201")) %>%
rename_with(~ str_replace(.x, "_1_2020", "_01_2020")) %>%
rename_with(~ str_replace(.x, "_2_201", "_02_201")) %>%
rename_with(~ str_replace(.x, "_2_2020", "_02_2020")) %>%
rename_with(~ str_replace(.x, "_3_201", "_03_201")) %>%
rename_with(~ str_replace(.x, "_3_2020", "_03_2020")) %>%
rename_with(~ str_replace(.x, "_4_201", "_04_201")) %>%
rename_with(~ str_replace(.x, "_4_2020", "_04_2020")) %>%
rename_with(~ str_replace(.x, "_5_201", "_05_201")) %>%
rename_with(~ str_replace(.x, "_5_2020", "_05_2020")) %>%
rename_with(~ str_replace(.x, "_6_201", "_06_201")) %>%
rename_with(~ str_replace(.x, "_6_2020", "_06_2020")) %>%
rename_with(~ str_replace(.x, "_7_201", "_07_201")) %>%
rename_with(~ str_replace(.x, "_7_2020", "_07_2020")) %>%
rename_with(~ str_replace(.x, "_8_201", "_08_201")) %>%
rename_with(~ str_replace(.x, "_8_2020", "_08_2020")) %>%
rename_with(~ str_replace(.x, "_9_201", "_09_201")) %>%
rename_with(~ str_replace(.x, "_9_2020", "_09_2020")) %>%
mutate(name = as.character(name)) %>%
arrange(name) %>%
mutate(name = as_factor(name))
rm(list = setdiff(ls(), c("species")))
### 2 Traits #####################################################################################
traits <- read_csv2("data_raw_traits.csv", col_names = T, na = c("", "NA", "na"), col_types =
cols(
.default = col_factor(),
name = col_factor(),
l = col_double(),
t = col_double(),
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
### Packages ###
library(tidyverse)
library(sf)
library(ggmap)
library(tmap)
library(ggrepel)
library(RColorBrewer)
library(patchwork)
### Start ###
rm(list = ls())
setwd("Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_old_dikes/data/processed/shp_files")
### Load data ###
germany <- st_read("germany.shp")
danube <- st_read("danube.shp")
sites <- st_read("sites.shp")
grazing <- st_read("grazing.shp")
conservation_area <- st_read("conservation_area.shp")
ffh_area <- st_read("ffh_area.shp")
dikes <- st_read("dikes.shp")
#sites <- do.call(rbind, st_geometry(sites)) %>%
#  as_tibble() %>%
#  setNames(c("lon","lat"))
sites2 <- read_csv2("sites2.csv", col_names = T, col_types =
cols(
id = col_factor(),
phosphorousClass = col_factor(levels = c("A","B","C","D","E"))
)
)
blocks <- read_csv2("blocks.csv", col_names = T, col_types =
cols(location = col_factor())
)
### Packages ###
library(tidyverse)
library(sf)
library(raster)
library(ggmap)
library(tmap)
library(RColorBrewer)
library(ggrepel)
library(patchwork)
### Start ###
rm(list = ls())
setwd("Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/data/processed/spatial")
### Load data ###
germany <- st_read("germany.shp")
danube <- st_read("danube.shp")
dikes <- st_read("dikes.shp")
blocks <- st_read("blocks.shp")
blocks2 <- read_csv2("blocks2.csv", col_names = T, col_types =
cols(block = col_factor())
)
tmap_mode("plot")
bbox <- st_bbox(c(ymin = 48.835, ymax = 48.845, xmin = 12.87, xmax = 12.895))
#tm_shape(bg_google_satellite2, bbox = bbox) +
#tm_raster()
tm_shape(dikes, bbox = bbox) +
tm_lines() +
tm_shape(danube) +
tm_fill() +
tm_text("river") +
tm_shape(blocks) +
tm_fill("red") +
tm_text("block", size = 1, col = "black", ymod = 0.7) +
tm_compass(position = c("left", "bottom"), size = 2) +
tm_scale_bar(position = c("left", "bottom", with = 0.4)) +
tm_layout(frame = F)
ggsave("figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi = 300, width = 8, height = 11, units = "cm",
path = "Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures")
(tmap_ger <- tm_shape(germany) +
tm_borders() +
tm_shape(blocks) +
tm_fill())
(tmap_ger <- tm_shape(germany) +
tm_borders() +
tm_layout(frame = F))
#tm_shape(bg_google_satellite2, bbox = bbox) +
#tm_raster()
(tmap <- tm_shape(dikes, bbox = bbox) +
tm_lines() +
tm_shape(danube) +
tm_fill() +
tm_text("river") +
tm_shape(blocks) +
tm_fill("red") +
tm_text("block", size = 1, col = "black", ymod = 0.7) +
tm_compass(position = c("left", "bottom"), size = 2) +
tm_scale_bar(position = c("left", "bottom", with = 0.4)) +
tm_layout(frame = F))
tmap_save(tmap, "figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi = 300, width = 8, height = 11, units = "cm",
path = "Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures")
tmap_save(tmap, "Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures/figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi = 300, width = 8, height = 11, units = "cm")
library(grid)
save_tmap(tmap,
insets_tm = tmap_ger,
insets_vp = viewport(x=2,
y=.15,
width=.2,
height=.3),
filename="Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures/figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi=300)
library(grid)
tm_save(tmap,
insets_tm = tmap_ger,
insets_vp = viewport(x=2,
y=.15,
width=.2,
height=.3),
filename="Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures/figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi=300)
tmap_save(tmap,
insets_tm = tmap_ger,
insets_vp = viewport(x=2,
y=.15,
width=.2,
height=.3),
filename="Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures/figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi=300)
tmap_save(tmap,
insets_tm = tmap_ger,
insets_vp = viewport(x = unit(.5, "cm"),
y = unit(.5, "cm"),
width = unit(2, "cm"),
height = unit(3, "cm")),
filename="Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures/figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi=300)
(tmap_ger <- tm_shape(germany) +
tm_borders(col = "black") +
tm_layout(frame = F))
library(grid)
tmap_save(tmap,
insets_tm = tmap_ger,
insets_vp = viewport(x = unit(2.5, "cm"),
y = unit(3.5, "cm"),
width = unit(2, "cm"),
height = unit(3, "cm")),
filename="Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures/figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi=300)
#tm_shape(bg_google_satellite2, bbox = bbox) +
#tm_raster()
(tmap <- tm_shape(dikes, bbox = bbox) +
tm_lines() +
tm_shape(danube) +
tm_fill() +
tm_text("river") +
tm_shape(blocks) +
tm_fill("red") +
tm_text("block", size = 1, col = "black", ymod = 0.7) +
tm_compass(position = c("right", "bottom"), size = 2) +
tm_scale_bar(position = c("right", "bottom", with = 0.4)) +
tm_layout(frame = F))
library(grid)
tmap_save(tmap,
insets_tm = tmap_ger,
insets_vp = viewport(x = unit(2.5, "cm"),
y = unit(3.1, "cm"),
width = unit(2, "cm"),
height = unit(3, "cm")),
filename="Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures/figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi=300)
#tm_shape(bg_google_satellite2, bbox = bbox) +
#tm_raster()
(tmap <- tm_shape(dikes, bbox = bbox) +
tm_lines() +
tm_shape(danube) +
tm_fill(col = "grey") +
tm_text("river") +
tm_shape(blocks) +
tm_fill("red") +
tm_text("block", size = 1, col = "black", ymod = 0.7) +
tm_compass(position = c("right", "bottom"), size = 2) +
tm_scale_bar(position = c("right", "bottom", with = 0.4)) +
tm_layout(frame = F))
library(grid)
tmap_save(tmap,
insets_tm = tmap_ger,
insets_vp = viewport(x = unit(2.5, "cm"),
y = unit(3.1, "cm"),
width = unit(2, "cm"),
height = unit(3, "cm")),
filename="Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures/figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi=300)
tmap_save(tmap,
insets_tm = tmap_ger,
insets_vp = viewport(x = unit(3.1, "cm"),
y = unit(4.1, "cm"),
width = unit(3, "cm"),
height = unit(4, "cm")),
filename="Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures/figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi=300)
tmap_save(tmap,
insets_tm = tmap_ger,
insets_vp = viewport(x = unit(3.1, "cm"),
y = unit(3.5, "cm"),
width = unit(3, "cm"),
height = unit(4, "cm")),
filename = "Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures/figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi = 300)
#tm_shape(bg_google_satellite2, bbox = bbox) +
#tm_raster()
(tmap <- tm_shape(dikes, bbox = bbox) +
tm_lines() +
tm_shape(danube) +
tm_fill(col = "grey") +
tm_text("river") +
tm_shape(blocks2) +
tm_fill("red") +
tm_text("block", size = 1, col = "black", ymod = 0.7) +
tm_compass(position = c("right", "bottom"), size = 2) +
tm_scale_bar(position = c("right", "bottom", with = 0.4)) +
tm_layout(frame = F))
#tm_shape(bg_google_satellite2, bbox = bbox) +
#tm_raster()
(tmap <- tm_shape(dikes, bbox = bbox) +
tm_lines() +
tm_shape(danube) +
tm_fill(col = "grey") +
tm_text("river") +
tm_shape(st_as_sf(blocks2)) +
tm_fill("red") +
tm_text("block", size = 1, col = "black", ymod = 0.7) +
tm_compass(position = c("right", "bottom"), size = 2) +
tm_scale_bar(position = c("right", "bottom", with = 0.4)) +
tm_layout(frame = F))
tmap_save(tmap,
insets_tm = tmap_ger,
insets_vp = viewport(x = unit(3.1, "cm"),
y = unit(3.3, "cm"),
width = unit(3, "cm"),
height = unit(4, "cm")),
filename = "Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures/figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi = 300)
#tm_shape(bg_google_satellite2, bbox = bbox) +
#tm_raster()
(tmap <- tm_shape(dikes, bbox = bbox) +
tm_lines() +
tm_shape(danube) +
tm_fill(col = "grey") +
tm_text("river") +
tm_shape(blocks) +
tm_fill("red") +
tm_text("block", size = 1, col = "black", ymod = 0.7) +
tm_compass(position = c("right", "bottom"), size = 2) +
tm_scale_bar(position = c("right", "bottom", with = 0.4)) +
tm_layout(frame = F))
library(grid)
tmap_save(tmap,
insets_tm = tmap_ger,
insets_vp = viewport(x = unit(3.1, "cm"),
y = unit(3.3, "cm"),
width = unit(3, "cm"),
height = unit(4, "cm")),
filename = "Z:/Documents/0_Uni/2022_Donaudeiche/3_Aufnahmen_und_Ergebnisse/2022_Danube_dike_experiment/outputs/figures/figure_1_map_tmap_(300dpi_8x11cm).tiff",
dpi = 300)
