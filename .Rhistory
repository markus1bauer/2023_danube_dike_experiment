nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_soil))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
sites_soil_selected <- sites %>%
select(sandRatio)
#### * Seedmix ####
m1 <- dbrda(beta_substitution ~ targetType + seedDensity, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_substitution,
sites_seedmix,
adjR2thresh = r2adj,
nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_seedmix))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
sites_seedmix_selected <- sites %>%
select(targetType_numeric)
#### * Space ####
m1 <- dbrda(beta_substitution ~ exposition + block, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_substitution,
sites_space,
adjR2thresh = r2adj,
nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_space))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
#### * Space ####
m1 <- dbrda(beta_substitution ~ exposition + block, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_substitution,
sites_space,
adjR2thresh = r2adj,
nperm = 9999)
sel <- forward.sel(beta_substitution,
sites_space,
#adjR2thresh = r2adj,
nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_space))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
sites_space_selected <- sites %>%
select(exposition_numeric, block_numeric)
m1_substitution_varpart <- varpart(
beta_substitution,
sites_soil_selected, sites_seedmix_selected, sites_space_selected
)
tiff(
here("outputs", "figures", "figure_2021_replacement_800dpi_12x12cm.tiff"),
res = 72, width = 12, height = 12, units = "cm", compression = "none"
)
plot(
m1_substitution_varpart,
Xnames = c("Site", "Seedmix", "Space"),
cutoff = 0.01, digits = 2, bg = NA
)
dev.off()
### Start ###
rm(list = ls())
setwd(here("data", "processed"))
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE,
na = c("na", "NA", ""), col_types =
cols(
.default = "?",
id = "f",
plot = "f",
block = "f",
exposition = "f",
sandRatio = "d",
substrateDepth = "d",
targetType = "f",
seedDensity = "d"
)) %>%
filter(surveyYear == 2021 & !str_detect(id, "C")) %>%
select(
id, plot, block, exposition, sandRatio, substrateDepth, targetType,
seedDensity, surveyYear, vegetationCov
) %>%
mutate(
exposition_numeric = as.double(exposition),
targetType_numeric = as.double(targetType),
block_numeric = as.double(block)
)
species <- read_csv("data_processed_species.csv",
col_names = TRUE,
na = c("na", "NA", ""), col_types =
cols(
.default = "d",
name = "f"
)
) %>%
mutate(across(where(is.numeric), ~ replace(., is.na(.), 0))) %>%
pivot_longer(-name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = name, values_from = "value") %>%
semi_join(sites, by = "id") %>%
arrange(id) %>%
column_to_rownames("id")
sites <- sites %>%
column_to_rownames("id")
sites_soil <- sites %>%
select(sandRatio, substrateDepth)
sites_seedmix <- sites %>%
select(targetType_numeric, seedDensity)
sites_space <- sites %>%
select(exposition_numeric)
#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# B Statistics ##########################################################
#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
## 1 Beta diversity #####################################################
### * check collinearity ####
data <- sites %>%
select(where(is.numeric), -ends_with("numeric"), -surveyYear)
GGally::ggpairs(data, lower = list(continuous = "smooth_loess"))
#--> no relationship has r > 0.7 (Dormann et al. 2013 Ecography)
### * Calculate: Baselga presence-absence ####
beta <- beta.div.comp(species, coef = "BS", quant = FALSE)
beta$Note
beta$part # total = 0.325, substitution = 0.279, subsets = 0.046
beta_total <- beta$D %>% # sörensen dissimilarity
as.matrix() %>%
as.data.frame()
beta_substitution <- beta$repl %>% # replacement / simpson dissimilarity
as.matrix()
beta_subsets <- beta$rich %>% # nestedness
as.matrix()
## 2 Variation partitioning: overall ##########################################
m1_total_varpart <- varpart(beta_total, sites_soil, sites_seedmix, sites_space)
plot(
m1_total_varpart,
Xnames = c("Substrate", "Seedmix", "Space"),
cutoff = 0.01, digits = 1, bg = NA, id.size = 1
)
sites_soil_selected <- sites %>%
select(sandRatio)
sites_seedmix_selected <- sites %>%
select(targetType_numeric)
sites_space_selected <- sites %>%
select(exposition_numeric)
m1_substitution_varpart <- varpart(
beta_substitution,
sites_soil_selected, sites_seedmix_selected, sites_space_selected
)
tiff(
here("outputs", "figures", "figure_2021_replacement_800dpi_12x12cm.tiff"),
res = 72, width = 12, height = 12, units = "cm", compression = "none"
)
plot(
m1_substitution_varpart,
Xnames = c("Site", "Seedmix", "Space"),
cutoff = 0.01, digits = 2, bg = NA
)
dev.off()
#### * Soil ####
m1_substitution <- dbrda(
beta_substitution ~ sandRatio +
Condition(targetType + exposition),
data = sites
)
anova(m1_substitution, permutations = how(nperm = 9999)) # p = 1e-04 ***
RsquareAdj(m1_substitution) # R2adj = .079
#### * Seedmix / targetType ####
m1_substitution <- dbrda(
beta_substitution ~ targetType +
Condition(exposition + sandRatio),
data = sites
)
anova(m1_substitution, permutations = how(nperm = 9999)) # p = 1e-04***
RsquareAdj(m1_substitution) # R2adj = .028
#### * Exposition / exposition ####
m1_substitution <- dbrda(
beta_substitution ~ exposition +
Condition(sandRatio + targetType),
data = sites
)
anova(m1_substitution, permutations = how(nperm = 9999)) # p = 1e-04 ***
RsquareAdj(m1_substitution) # R2adj = .035
### a full model --------------------------------------------------------------
m1 <- dbrda(
beta_subsets ~ sandRatio + substrateDepth +
seedDensity + targetType + exposition,
data = sites
)
anova(m1, permutations = how(nperm = 9999)) # P = 1e-04
(r2adj <- RsquareAdj(m1)$adj.r.squared) # R2adj = .506
#### * Soil ####
m1 <- dbrda(
beta_subsets ~ substrateDepth + sandRatio, data = sites
)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_subsets,
sites_soil,
adjR2thresh = r2adj,
nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_soil))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
sel <- forward.sel(beta_subsets,
sites_soil,
#adjR2thresh = r2adj,
nperm = 9999)
#### * Soil ####
m1 <- dbrda(
beta_subsets ~ sandRatio + substrateDepth, data = sites
)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_subsets,
sites_soil,
#adjR2thresh = r2adj,
nperm = 9999)
sites_soil_selected <- sites %>%
select()
#### * Seedmix ####
m1 <- dbrda(beta_subsets ~ targetType + seedDensity, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_subsets,
sites_seedmix,
adjR2thresh = r2adj,
nperm = 9999)
sel <- forward.sel(beta_subsets,
sites_seedmix,
#adjR2thresh = r2adj,
nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_seedmix))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
sites_seedmix_selected <- sites %>%
select()
#### * exposition ####
m1 <- dbrda(beta_subsets ~ exposition, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_subsets,
sites_space,
adjR2thresh = r2adj,
nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_space))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
sites_space_selected <- sites %>%
select(exposition_numeric)
m1_subsets_varpart <- varpart(
beta_subsets, sites_space_selected
)
tiff(
here("outputs", "figures", "figure_2021_nestedness_800dpi_12x12cm.tiff"),
res = 72, width = 12, height = 12, units = "cm", compression = "none"
)
plot(
m1_subsets_varpart,
Xnames = c("Exposition"),
cutoff = 0.01, digits = 2, bg = NA
)
m1_subsets_varpart <- varpart(
beta_subsets, sites_space_selected
)
sites_seedmix_selected <- sites %>%
select(seedDensity) #Dummy
m1_subsets_varpart <- varpart(
beta_subsets, sites_seedmix_selected, sites_space_selected
)
tiff(
here("outputs", "figures", "figure_2021_nestedness_800dpi_12x12cm.tiff"),
res = 72, width = 12, height = 12, units = "cm", compression = "none"
)
plot(
m1_subsets_varpart,
Xnames = c("Seedmix", "Exposition"),
cutoff = 0.01, digits = 2, bg = NA
)
dev.off()
sites_soil_selected <- sites %>%
select(sandRatio)
sites_seedmix_selected <- sites %>%
select(targetType_numeric)
#### * Exposition ####
m1 <- dbrda(beta_substitution ~ exposition, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_substitution,
sites_space,
adjR2thresh = r2adj,
nperm = 9999)
sel <- forward.sel(beta_substitution,
sites_space,
#adjR2thresh = r2adj,
nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_space))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
sites_space_selected <- sites %>%
select(exposition_numeric)
m1_substitution_varpart <- varpart(
beta_substitution,
sites_soil_selected, sites_seedmix_selected, sites_space_selected
)
tiff(
here("outputs", "figures", "figure_2021_replacement_800dpi_12x12cm.tiff"),
res = 72, width = 12, height = 12, units = "cm", compression = "none"
)
plot(
m1_substitution_varpart,
Xnames = c("Site", "Seedmix", "Space"),
cutoff = 0.01, digits = 2, bg = NA
)
dev.off()
m1_substitution_varpart <- varpart(
beta_substitution,
sites_soil_selected, sites_seedmix_selected, sites_space_selected
)
tiff(
here("outputs", "figures", "figure_2021_replacement_800dpi_12x12cm.tiff"),
res = 72, width = 12, height = 12, units = "cm", compression = "none"
)
plot(
m1_substitution_varpart,
Xnames = c("Site", "Seedmix", "Exposition"),
cutoff = 0.01, digits = 2, bg = NA
)
dev.off()
### Start ###
rm(list = ls())
setwd(here("data", "processed"))
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE,
na = c("na", "NA", ""), col_types =
cols(
.default = "?",
id = "f",
plot = "f",
block = "f",
exposition = "f",
sandRatio = "d",
substrateDepth = "d",
targetType = "f",
seedDensity = "d"
)) %>%
filter(surveyYear == 2018 & !str_detect(id, "C")) %>%
select(
id, plot, block, exposition, sandRatio, substrateDepth, targetType,
seedDensity, surveyYear, vegetationCov
) %>%
mutate(
exposition_numeric = as.double(exposition),
targetType_numeric = as.double(targetType),
block_numeric = as.double(block)
)
species <- read_csv("data_processed_species.csv",
col_names = TRUE,
na = c("na", "NA", ""), col_types =
cols(
.default = "d",
name = "f"
)
) %>%
mutate(across(where(is.numeric), ~ replace(., is.na(.), 0))) %>%
pivot_longer(-name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = name, values_from = "value") %>%
semi_join(sites, by = "id") %>%
arrange(id) %>%
column_to_rownames("id")
sites <- sites %>%
column_to_rownames("id")
sites_soil <- sites %>%
select(sandRatio, substrateDepth)
sites_seedmix <- sites %>%
select(targetType_numeric, seedDensity)
sites_space <- sites %>%
select(exposition_numeric)
### * check collinearity ####
data <- sites %>%
select(where(is.numeric), -ends_with("numeric"), -surveyYear)
GGally::ggpairs(data, lower = list(continuous = "smooth_loess"))
### * Calculate: Baselga presence-absence ####
beta <- beta.div.comp(species, coef = "BS", quant = FALSE)
beta$Note
beta$part # total = 0.325, substitution = 0.279, subsets = 0.046
### * Calculate: Baselga presence-absence ####
beta <- beta.div.comp(species, coef = "BS", quant = FALSE)
beta$Note
beta$part # total = 0.316, substitution = 0.245, subsets = 0.070
### * Calculate: Baselga presence-absence ####
set.seed(1)
beta <- beta.div.comp(species, coef = "BS", quant = FALSE)
beta$Note
beta$part # total = 0.316, substitution = 0.245, subsets = 0.070
beta_total <- beta$D %>% # sörensen dissimilarity
as.matrix() %>%
as.data.frame()
beta_substitution <- beta$repl %>% # replacement / simpson dissimilarity
as.matrix()
beta_subsets <- beta$rich %>% # nestedness
as.matrix()
m1_total_varpart <- varpart(beta_total, sites_soil, sites_seedmix, sites_space)
plot(
m1_total_varpart,
Xnames = c("Substrate", "Seedmix", "Space"),
cutoff = 0.01, digits = 1, bg = NA, id.size = 1
)
### a full model --------------------------------------------------------------
m1 <- dbrda(
beta_substitution ~ sandRatio + substrateDepth + exposition +
seedDensity + targetType,
data = sites
)
anova(m1, permutations = how(nperm = 9999)) # P = 1e-04
(r2adj <- RsquareAdj(m1)$adj.r.squared) # R2adj = .398
#### * Soil ####
m1 <- dbrda(
beta_substitution ~ substrateDepth + sandRatio, data = sites
)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_substitution,
sites_soil,
adjR2thresh = r2adj,
nperm = 9999)
#### * Soil ####
m1 <- dbrda(
beta_substitution ~ sandRatio + substrateDepth, data = sites
)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_substitution,
sites_soil,
adjR2thresh = r2adj,
nperm = 9999)
sel <- forward.sel(beta_substitution,
sites_soil,
#adjR2thresh = r2adj,
nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_soil))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
#### * Seedmix ####
m1 <- dbrda(beta_substitution ~ targetType + seedDensity, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_substitution,
sites_seedmix,
adjR2thresh = r2adj,
nperm = 9999)
sites_seedmix_selected <- sites %>%
select()
#### * Exposition ####
m1 <- dbrda(beta_substitution ~ exposition, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_substitution,
sites_space,
#adjR2thresh = r2adj,
nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_space))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
sites_space_selected <- sites %>%
select(exposition_numeric)
m1_substitution_varpart <- varpart(
beta_substitution,
sites_soil_selected, sites_seedmix_selected, sites_space_selected
)
sites_seedmix_selected <- sites %>%
select(seedDensity) # Dummy
m1_substitution_varpart <- varpart(
beta_substitution,
sites_seedmix_selected, sites_space_selected
)
tiff(
here("outputs", "figures", "figure_2018_replacement_800dpi_12x12cm.tiff"),
res = 72, width = 12, height = 12, units = "cm", compression = "none"
)
plot(
m1_substitution_varpart,
Xnames = c("Seedmix", "Exposition"),
cutoff = 0.01, digits = 2, bg = NA
)
dev.off()
m1 <- dbrda(
beta_subsets ~ sandRatio + substrateDepth +
seedDensity + targetType + exposition,
data = sites
)
anova(m1, permutations = how(nperm = 9999)) # P = 1e-04
#### * Soil ####
m1 <- dbrda(
beta_subsets ~ sandRatio + substrateDepth, data = sites
)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_subsets,
sites_soil,
#adjR2thresh = r2adj,
nperm = 9999)
#### * Seedmix ####
m1 <- dbrda(beta_subsets ~ targetType + seedDensity, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_subsets,
sites_seedmix,
#adjR2thresh = r2adj,
nperm = 9999)
sites_seedmix_selected <- sites %>%
select(seedDensity) #Dummy
#### * exposition ####
m1 <- dbrda(beta_subsets ~ exposition, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_subsets,
sites_space,
adjR2thresh = r2adj,
nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_space))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
sites_space_selected <- sites %>%
select(exposition_numeric)
m1_subsets_varpart <- varpart(
beta_subsets, sites_seedmix_selected, sites_space_selected
)
tiff(
here("outputs", "figures", "figure_2018_nestedness_800dpi_12x12cm.tiff"),
res = 72, width = 12, height = 12, units = "cm", compression = "none"
)
plot(
m1_subsets_varpart,
Xnames = c("Seedmix", "Exposition"),
cutoff = 0.01, digits = 2, bg = NA
)
dev.off()
