col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_bauer <- read_csv("data_processed_species_bauer.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
### Exclude rare species (< 0.5% accumulated cover in all plots)
data <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
group_by(name) %>%
summarise(total_cover_species = sum(value)) %>%
filter(total_cover_species < 0.5)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
filter(!(name %in% data$name)) %>% # use 'data' to filter
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id")
sites <- sites %>%
semi_join(species, by = "id")
load(file = here("outputs", "models", "model_nmds.Rdata"))
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
group_by(exposition, target_type)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
group_by(exposition, target_type) %>%
mutate(data = sites %>% filter(reference == "+Reference"), mean = mean(nmds1))
sites %>% filter(reference == "+Reference")
View(sites)
### Load data ###
sites_experiment <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?")) %>%
mutate(reference = survey_year)
View(sites_experiment)
View(sites)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) #%>%
View(sites2)
group_by(exposition, target_type) %>%
mutate(mean = mean(nmds1))
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
group_by(exposition, target_type) %>%
mutate(mean = mean(nmds1))
View(sites)
View(sites2)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
group_by(exposition, target_type) %>%
mutate(mean = mean(nmds1)) %>%
pivot_wider(names_from = "reference", values_from = "mean")
View(sites2)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
summarize(mean(nmds1))
View(sites2)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
group_by(exposition, target_type) %>%
summarize(mean(nmds1))
View(sites2)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
group_by(exposition, target_type, reference) %>%
summarize(mean(nmds1))
View(sites2)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
group_by(exposition, target_type, reference) %>%
summarize(mean_reference = mean(nmds1)) %>%
filter(reference = "+Reference")
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
group_by(exposition, target_type, reference) %>%
summarize(mean_reference = mean(nmds1)) %>%
filter(reference == "+Reference")
View(sites2)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
group_by(exposition, target_type, reference) %>%
summarize(mean_reference = mean(nmds1)) %>%
filter(reference == "+Reference") %>%
select(-reference)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
group_by(exposition, target_type, reference) %>%
mutate(mean_reference = mean(nmds1)) %>%
filter(reference == "+Reference") %>%
select(-reference)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
group_by(exposition, target_type, reference) %>%
mutate(mean_reference = mean(nmds1)) %>%
filter(reference == "+Reference")
View(sites2)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
group_by(exposition, target_type, reference) %>%
mutate(mean_reference = mean(nmds1))
View(sites2)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
filter(reference == "+Reference")
View(sites2)
sites2 <- sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
filter(reference == "+Reference") %>%
group_by(exposition, target_type) %>%
mutate(mean_reference = mean(nmds1))
View(sites2)
sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
filter(reference == "+Reference") %>%
group_by(exposition, target_type) %>%
mutate(mean_reference = mean(nmds1))
sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
filter(reference == "+Reference") %>%
group_by(exposition, target_type) %>%
summarise(mean_reference = mean(nmds1))
sites2 <- sites %>%
mutate(mean_reference = if_else(
exposition == "north" & target_type = "dry_grassland", 0.644, if_else(
sites2 <- sites %>%
mutate(mean_reference = if_else(
exposition == "north" & target_type == "dry_grassland", 0.644, if_else(
exposition == "north" & target_type == "hay_meadow", 0.485, if_else(
exposition == "south" & target_type == "dry_grassland", 0.542, if_else(
exposition == "south" & target_type == "hay_meadow", 0.469, NA_real_
)
)
)
))
View(sites2)
sites <- sites %>%
mutate(mean_reference = if_else(
exposition == "north" & target_type == "dry_grassland", 0.644, if_else(
exposition == "north" & target_type == "hay_meadow", 0.485, if_else(
exposition == "south" & target_type == "dry_grassland", 0.542, if_else(
exposition == "south" & target_type == "hay_meadow", 0.469, NA_real_
)
)
)
)) %>%
filter(reference == "2018" | reference == "2019" | reference == "2020" |
reference == "2021")
View(sites)
rm(list = setdiff(ls(), c(
"sites", "theme_mb", "vegan_cov_ellipse", "ordi"
)))
plot1 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = sand_ratio)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Sand ratio [vol%] (Data of 2021)")
plot2 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = substrate_depth)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Substrate depth [cm] (Data of 2021)")
plot3 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = target_type)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Target type (Data of 2021)")
plot4 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = seed_density)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Seed density [g/m²] (Data of 2021)")
(plot1 + plot2) / (plot3 + plot4)
sites <- sites %>%
mutate(
nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2],
mean_reference = if_else(
exposition == "north" & target_type == "dry_grassland", 0.644, if_else(
exposition == "north" & target_type == "hay_meadow", 0.485, if_else(
exposition == "south" & target_type == "dry_grassland", 0.542, if_else(
exposition == "south" & target_type == "hay_meadow", 0.469, NA_real_
)
)
)
),
n = mean_reference - nmds1
) %>%
filter(reference == "2018" | reference == "2019" | reference == "2020" |
reference == "2021")
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
library(brms)
library(DHARMa)
library(bayesplot)
library(loo)
library(tidybayes)
library(emmeans)
### Start ###
rm(list = ls())
### Load data ###
sites_experiment <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?")) %>%
mutate(reference = survey_year)
sites_splot <- read_csv("data_processed_sites_splot.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
survey_year = "c"
)) %>%
mutate(
reference = if_else(
esy == "E12a", "+Reference", if_else(
esy == "E22", "+Reference", "other"
)
),
target_type = if_else(
esy == "E12a", "dry_grassland", if_else(
esy == "E22", "hay_meadow", "other"
)
),
exposition = "other"
)
sites_bauer <- read_csv("data_processed_sites_bauer.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
survey_year = "c"
)) %>%
filter(exposition == "south" | exposition == "north") %>%
mutate(
reference = if_else(
esy == "R1A", "+Reference", if_else(
esy == "R22", "+Reference", if_else(
esy == "R", "Grassland", if_else(
esy == "?", "no", if_else(
esy == "+", "no", if_else(
esy == "R21", "Grassland", if_else(
esy == "V38", "-Reference", "other"
)
)
)
)
)
)
),
target_type = if_else(
esy == "R1A", "dry_grassland", if_else(
esy == "R22", "hay_meadow", "other"
)
)
)
sites <- sites_experiment %>%
bind_rows(sites_splot, sites_bauer) %>%
select(
id, esy, reference,
exposition, sand_ratio, substrate_depth, target_type, seed_density,
survey_year, longitude, latitude, elevation, plot_size
) %>%
arrange(id)
#### * Load species data ####
species_experiment <- read_csv("data_processed_species.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_splot <- read_csv("data_processed_species_splot.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_bauer <- read_csv("data_processed_species_bauer.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
### Exclude rare species (< 0.5% accumulated cover in all plots)
data <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
group_by(name) %>%
summarise(total_cover_species = sum(value)) %>%
filter(total_cover_species < 0.5)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
filter(!(name %in% data$name)) %>% # use 'data' to filter
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id")
sites <- sites %>%
semi_join(species, by = "id")
load(file = here("outputs", "models", "model_nmds.Rdata"))
sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
filter(reference == "+Reference") %>%
group_by(exposition, target_type) %>%
summarise(mean_reference = mean(nmds1))
sites <- sites %>%
mutate(
nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2],
mean_reference = if_else(
exposition == "north" & target_type == "dry_grassland", 0.644, if_else(
exposition == "north" & target_type == "hay_meadow", 0.485, if_else(
exposition == "south" & target_type == "dry_grassland", 0.542, if_else(
exposition == "south" & target_type == "hay_meadow", 0.469, NA_real_
)
)
)
),
n = mean_reference - nmds1
) %>%
filter(reference == "2018" | reference == "2019" | reference == "2020" |
reference == "2021")
rm(list = setdiff(ls(), c(
"sites", "theme_mb", "vegan_cov_ellipse", "ordi"
)))
rm(list = setdiff(ls(), c("sites")))
plot1 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = sand_ratio)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Sand ratio [vol%] (Data of 2021)")
plot2 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = substrate_depth)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Substrate depth [cm] (Data of 2021)")
plot3 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = target_type)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Target type (Data of 2021)")
plot4 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = seed_density)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Seed density [g/m²] (Data of 2021)")
(plot1 + plot2) / (plot3 + plot4)
### Start ###
rm(list = ls())
### Load data ###
sites_experiment <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
sand_ratio = "f",
substrate_depth = "f",
target_type = "f",
seed_density = "f"
)) %>%
mutate(reference = survey_year)
sites_splot <- read_csv("data_processed_sites_splot.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
survey_year = "c"
)) %>%
mutate(
reference = if_else(
esy == "E12a", "+Reference", if_else(
esy == "E22", "+Reference", "other"
)
),
target_type = if_else(
esy == "E12a", "dry_grassland", if_else(
esy == "E22", "hay_meadow", "other"
)
),
exposition = "other"
)
sites_bauer <- read_csv("data_processed_sites_bauer.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
survey_year = "c"
)) %>%
filter(exposition == "south" | exposition == "north") %>%
mutate(
reference = if_else(
esy == "R1A", "+Reference", if_else(
esy == "R22", "+Reference", if_else(
esy == "R", "Grassland", if_else(
esy == "?", "no", if_else(
esy == "+", "no", if_else(
esy == "R21", "Grassland", if_else(
esy == "V38", "-Reference", "other"
)
)
)
)
)
)
),
target_type = if_else(
esy == "R1A", "dry_grassland", if_else(
esy == "R22", "hay_meadow", "other"
)
)
)
sites <- sites_experiment %>%
bind_rows(sites_splot, sites_bauer) %>%
select(
id, esy, reference,
exposition, sand_ratio, substrate_depth, target_type, seed_density,
survey_year, longitude, latitude, elevation, plot_size
) %>%
arrange(id)
#### * Load species data ####
species_experiment <- read_csv("data_processed_species.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_splot <- read_csv("data_processed_species_splot.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_bauer <- read_csv("data_processed_species_bauer.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
### Exclude rare species (< 0.5% accumulated cover in all plots)
data <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
group_by(name) %>%
summarise(total_cover_species = sum(value)) %>%
filter(total_cover_species < 0.5)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
filter(!(name %in% data$name)) %>% # use 'data' to filter
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id")
sites <- sites %>%
semi_join(species, by = "id")
load(file = here("outputs", "models", "model_nmds.Rdata"))
sites %>%
mutate(nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2]) %>%
filter(reference == "+Reference") %>%
group_by(exposition, target_type) %>%
summarise(mean_reference = mean(nmds1))
sites <- sites %>%
mutate(
nmds1 = ordi$points[, 1], nmds2 = ordi$points[, 2],
mean_reference = if_else(
exposition == "north" & target_type == "dry_grassland", 0.644, if_else(
exposition == "north" & target_type == "hay_meadow", 0.485, if_else(
exposition == "south" & target_type == "dry_grassland", 0.542, if_else(
exposition == "south" & target_type == "hay_meadow", 0.469, NA_real_
)
)
)
),
n = mean_reference - nmds1
) %>%
filter(reference == "2018" | reference == "2019" | reference == "2020" |
reference == "2021")
rm(list = setdiff(ls(), c("sites")))
#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# B Statistics #################################################################
#+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
## 1 Data exploration ##########################################################
### a Graphs of raw data -------------------------------------------------------
plot1 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = sand_ratio)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Sand ratio [vol%] (Data of 2021)")
plot2 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = substrate_depth)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Substrate depth [cm] (Data of 2021)")
plot3 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = target_type)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Target type (Data of 2021)")
plot4 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = seed_density)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Seed density [g/m²] (Data of 2021)")
(plot1 + plot2) / (plot3 + plot4)
plot1 <- ggplot(sites %>% filter(survey_year == 2021),
aes(y = n, x = exposition)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Exposition (Data of 2021)")
plot2 <- ggplot(sites, aes(y = n, x = survey_year_fct)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Survey year")
plot3 <- ggplot(sites %>% filter(survey_year == 2021), aes(y = n, x = site)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Blocks (Data of 2021)")
plot4 <- ggplot(sites, aes(y = n, x = botanist_year)) +
geom_quasirandom(color = "grey") + geom_boxplot(fill = "transparent") +
labs(title = "Botanists and survey year") +
theme(axis.text.x = element_text(angle = 90))
(plot1 + plot2) / (plot3 + plot4)
### Load data ###
sites_experiment <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
sand_ratio = "f",
substrate_depth = "f",
target_type = "f",
seed_density = "f",
exposition = "f",
site = "f",
botanist_year = "f"
)) %>%
mutate(
reference = survey_year,
survey_year_fct = factor(survey_year)
)
