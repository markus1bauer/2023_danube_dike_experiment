abundance = Original_abundance) %>%
mutate(id = paste0("S", id)) %>%
semi_join(data_sites, by = "id") %>%
select(id, name, abundance) %>%
pivot_wider(names_from = "id",
values_from = "abundance",
values_fn = sum) %>%
mutate(
name = str_replace(name, " ", "_"),
name = str_replace(name, "Helianthemum_ovatum", "Helianthemum_nummularium"),
name = str_replace(name, "Galium_album", "Galium_mollugo"),
name = str_replace(name, "Taraxacum", "Taraxacum_campylodes"),
name = str_replace(
name, "Cerastium_fontanum", "Cerastium_fontanum_ssp_vulgare"
),
name = str_replace(name, "Leucanthemum_ircutianum", "Leucanthemum_vulgare"),
name = str_replace(name, "Tragopogon_orientalis", "Tragopogon_pratensis"),
name = factor(name)
) %>%
group_by(name) %>%
summarise(across(everything(), ~ sum(.x, na.rm = TRUE)))
### Check species name congruency ###
data <- data_species %>%
anti_join(traits, by = "name") %>%
select(name) %>%
print(n = 50)
species_splot <- data_species
data_sites <- sites_bauer %>%
mutate(
reference = "reference",
plot_size = 25
) %>%
select(id, longitude, latitude, plot_size, survey_year, reference,
esy, exposition, orientation, plot_age, species_richness)
sites_bauer <- data_sites
data_species <- species_bauer
### Check species name congruency ###
data <- data_species %>%
anti_join(traits, by = "name") %>%
select(name) %>%
print(n = 50)
species_bauer <- data_species
rm(list = setdiff(ls(), c(
"sites_experiment", "sites_splot", "sites_bauer",
"species_experiment", "species_splot", "species_bauer",
"traits", "results.classification"
)))
#### Data of experiment ###
write_csv(
sites_experiment,
here("data", "processed", "data_processed_sites.csv")
)
write_csv(
species_experiment,
here("data", "processed", "data_processed_species.csv")
)
write_csv(
traits,
here("data", "processed", "data_processed_traits.csv")
)
#### Data of sPlotOpen ###
write_csv(
sites_splot,
here("data", "processed", "data_processed_sites_splot.csv")
)
write_csv(
species_splot,
here("data", "processed", "data_processed_species_splot.csv")
)
#### Data of Bauer et al. (2022) Zenodo ###
write_csv(
sites_bauer,
here("data", "processed", "data_processed_sites_bauer.csv")
)
write_csv(
species_bauer,
here("data", "processed", "data_processed_species_bauer.csv")
)
### Packages ###
library(here)
library(tidyverse)
library(vegan)
### Start ###
rm(list = setdiff(ls(), c("graph_a", "graph_b", "graph_c", "graph_d")))
setwd(here("data", "processed"))
### Functions ###
theme_mb <- function() {
theme(
panel.background = element_rect(fill = "white"),
text = element_text(size = 9, color = "black"),
strip.text = element_text(size = 10),
axis.text = element_text(angle = 0, hjust = 0.5, size = 9,
color = "black"),
axis.title = element_text(angle = 0, hjust = 0.5, size = 9,
color = "black"),
axis.line = element_line(),
legend.key = element_rect(fill = "white"),
legend.position = "bottom",
legend.margin = margin(0, 0, 0, 0, "cm"),
plot.margin = margin(0, 0, 0, 0, "cm")
)
}
veganCovEllipse <- function(cov, center = c(0, 0), scale = 1, npoints = 100) {
theta <- (0:npoints) * 2 * pi / npoints
Circle <- cbind(cos(theta), sin(theta))
t(center + scale * t(Circle %*% chol(cov)))
}
sites_experiment <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
sites_splot <- read_csv("data_processed_sites_splot.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
survey_year = "c"
))
sites_bauer <- read_csv("data_processed_sites_bauer.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
survey_year = "c"
))
sites <- sites_experiment %>%
bind_rows(sites_splot, sites_bauer) %>%
mutate(
reference = as.character(survey_year),
reference = if_else(
esy == "E12a", "Dry grassland", if_else(
esy == "E22", "Hay meadow", reference
)
),
esy = if_else(
esy == "E22", "R22-ref", if_else(
esy == "E12a", "R1A-ref", if_else(
esy == "?", "no", esy
)
)
)
) %>%
select(-givd_id, -longitude, -latitude)
species_experiment <- read_csv("data_processed_species.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_splot <- read_csv("data_processed_species_splot.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_bauer <- read_csv("data_processed_species_bauer.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") #%>%
View(species)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id")
rm(list = setdiff(ls(), c(
"sites", "species", "theme_mb", "vegan_cov_ellipse"
)))
### Packages ###
library(here)
library(tidyverse)
library(vegan)
### Start ###
rm(list = setdiff(ls(), c("graph_a", "graph_b", "graph_c", "graph_d")))
setwd(here("data", "processed"))
### Functions ###
theme_mb <- function() {
theme(
panel.background = element_rect(fill = "white"),
text = element_text(size = 9, color = "black"),
strip.text = element_text(size = 10),
axis.text = element_text(angle = 0, hjust = 0.5, size = 9,
color = "black"),
axis.title = element_text(angle = 0, hjust = 0.5, size = 9,
color = "black"),
axis.line = element_line(),
legend.key = element_rect(fill = "white"),
legend.position = "bottom",
legend.margin = margin(0, 0, 0, 0, "cm"),
plot.margin = margin(0, 0, 0, 0, "cm")
)
}
vegan_cov_ellipse <- function(cov, center = c(0, 0), scale = 1, npoints = 100) {
theta <- (0:npoints) * 2 * pi / npoints
Circle <- cbind(cos(theta), sin(theta))
t(center + scale * t(Circle %*% chol(cov)))
}
#### * Load sites data ####
sites_experiment <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
sites_splot <- read_csv("data_processed_sites_splot.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
survey_year = "c"
))
sites_bauer <- read_csv("data_processed_sites_bauer.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
survey_year = "c"
))
sites <- sites_experiment %>%
bind_rows(sites_splot, sites_bauer) %>%
mutate(
reference = as.character(survey_year),
reference = if_else(
esy == "E12a", "Dry grassland", if_else(
esy == "E22", "Hay meadow", reference
)
),
esy = if_else(
esy == "E22", "R22-ref", if_else(
esy == "E12a", "R1A-ref", if_else(
esy == "?", "no", esy
)
)
)
) %>%
select(-givd_id, -longitude, -latitude)
#### * Load species data ####
species_experiment <- read_csv("data_processed_species.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_splot <- read_csv("data_processed_species_splot.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_bauer <- read_csv("data_processed_species_bauer.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id")
rm(list = setdiff(ls(), c(
"sites", "species", "theme_mb", "vegan_cov_ellipse"
)))
#### * Model ####
(ordi <- metaMDS(species, binary = TRUE,
try = 99, previous.best = TRUE, na.rm = TRUE))
(ordi <- metaMDS(species, binary = TRUE,
try = 99, previous.best = TRUE, na.rm = TRUE))
set.seed(123)
(ordi <- metaMDS(species, binary = TRUE,
try = 99, previous.best = TRUE, na.rm = TRUE))
(ordi <- metaMDS(species, binary = TRUE,
try = 99, previous.best = TRUE, na.rm = TRUE))
View(species)
range(species)
table(is.na(species))
species_experiment <- read_csv("data_processed_species.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_splot <- read_csv("data_processed_species_splot.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_bauer <- read_csv("data_processed_species_bauer.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
(ordi <- metaMDS(species_experiment, binary = TRUE,
try = 99, previous.best = TRUE, na.rm = TRUE))
rm(list = setdiff(ls(), c(
"sites", "species", "theme_mb", "vegan_cov_ellipse"
)))
(ordi <- metaMDS(species %>% slice(5), binary = TRUE,
try = 99, previous.best = TRUE, na.rm = TRUE))
View(species)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id") %>%
rowSums()
species_experiment <- read_csv("data_processed_species.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_splot <- read_csv("data_processed_species_splot.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_bauer <- read_csv("data_processed_species_bauer.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id") %>%
rowSums()
range(species)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id") %>%
colSums()
range(species)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id") %>%
colSums()
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id")
rm(list = setdiff(ls(), c(
"sites", "species", "theme_mb", "vegan_cov_ellipse"
)))
set.seed(123)
(ordi <- metaMDS(species, binary = TRUE,
try = 99, previous.best = TRUE, na.rm = TRUE))
table(is.nan(species))
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id") %>%
summarise(across(everything(), ~sum(., na.rm = TRUE)))
species_experiment <- read_csv("data_processed_species.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_splot <- read_csv("data_processed_species_splot.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species_bauer <- read_csv("data_processed_species_bauer.csv",
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(.default = "?"))
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id") %>%
summarise(across(everything(), ~sum(., na.rm = TRUE)))
View(species)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id") %>%
summarise(across(everything(), ~sum(., na.rm = TRUE))) %>%
pivot_longer(names_to = "name", vlaues_to = "value")
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id") %>%
summarise(across(everything(), ~sum(., na.rm = TRUE))) %>%
pivot_longer(names_to = "name", values_to = "value")
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id") %>%
summarise(across(everything(), ~sum(., na.rm = TRUE))) %>%
pivot_longer(-Acer_campestre, names_to = "name", values_to = "value")
View(species)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") #%>%
View(species)
data <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
group_by(name) %>%
summarise(sum(value))
View(data)
data <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
group_by(name) %>%
summarise(total_cover_species = sum(value)) %>%
filter(total_cover_species > 0.5)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") #%>%
View(species)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
filter(name %in% data$name)
View(species)
data <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
group_by(name) %>%
summarise(total_cover_species = sum(value)) %>%
filter(total_cover_species > 0.5) %>%
mutate(name = factor(name))
data <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
group_by(name) %>%
summarise(total_cover_species = sum(value)) %>%
filter(total_cover_species < 0.5) %>%
mutate(name = factor(name))
data <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
group_by(name) %>%
summarise(total_cover_species = sum(value)) %>%
filter(total_cover_species < 0.5)
View(data)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
filter(name %in% data$name)
View(species)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
filter(name %in% data$name) %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id")
set.seed(123)
(ordi <- metaMDS(species, binary = TRUE,
try = 99, previous.best = TRUE, na.rm = TRUE))
View(species)
species <- species_experiment %>%
full_join(species_splot, by = "name") %>%
full_join(species_bauer, by = "name") %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(cols = -name, names_to = "id", values_to = "value") %>%
filter(!(name %in% data$name)) %>%
pivot_wider(names_from = "name", values_from = "value") %>%
arrange(id) %>%
semi_join(sites, by = "id") %>%
column_to_rownames("id")
set.seed(123)
(ordi <- metaMDS(species, binary = TRUE,
try = 99, previous.best = TRUE, na.rm = TRUE))
(ordi <- metaMDS(species, binary = TRUE,
try = 20, previous.best = TRUE, na.rm = TRUE))
stressplot(ordi) # stress: 0.207; Non-metric fit R² =.957
(ordi <- metaMDS(species, binary = TRUE,
try = 50, previous.best = TRUE, na.rm = TRUE))
