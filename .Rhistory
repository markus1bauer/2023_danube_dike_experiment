)
) %>%
ggplot(aes(x = .value, y = .variable)) +
geom_vline(xintercept = 0, linetype = "dashed") +
stat_halfeye() +
scale_x_continuous(breaks = seq(-100, 400, .5)) +
labs(x = expression(Delta ~ Favourabale ~ Conservation ~ Status ~ "(FCS)"),
y = "") +
theme_mb()
ggsave(here("outputs", "figures",
"figure_3_fcs_coef_800dpi_24x8cm2.tiff"),
dpi = 800, width = 24, height = 8, units = "cm")
ggsave(here("outputs", "figures",
"figure_3_fcs_coef_800dpi_16.5x14cm.tiff"),
dpi = 800, width = 16.5, height = 14, units = "cm")
ggsave(here("outputs", "figures",
"figure_3_fcs_coef_800dpi_16.5x14cm.tiff"),
dpi = 800, width = 16.5, height = 10, units = "cm")
ggsave(here("outputs", "figures",
"figure_3_fcs_coef_800dpi_16.5x14cm.tiff"),
dpi = 800, width = 16.5, height = 8, units = "cm")
ggsave(here("outputs", "figures",
"figure_3_fcs_coef_800dpi_16.5x14cm.tiff"),
dpi = 800, width = 16.5, height = 6, units = "cm")
ggsave(here("outputs", "figures",
"figure_3_fcs_coef_800dpi_16.5x6cm.tiff"),
dpi = 800, width = 16.5, height = 6, units = "cm")
ggsave(here("outputs", "figures",
"figure_3_fcs_coef_800dpi_16.5x5cm.tiff"),
dpi = 800, width = 16.5, height = 5, units = "cm")
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
library(patchwork)
library(brms)
### Start ###
rm(list = ls())
### Load data ###
sites <- read_csv(
here("data", "processed", "data_processed_sites_nmds.csv"),
col_names = TRUE, na = c("na", "NA", ""),
col_types = cols(
.default = "?",
id = "f",
plot = "f",
site = "f",
exposition = col_factor(levels = c("north", "south",
"other")),
sand_ratio = "f",
substrate_depth = col_factor(levels = c("30", "15")),
target_type = col_factor(
levels = c("hay_meadow", "dry_grassland", "other")
),
seed_density = "f"
)
) %>%
filter(reference == "2018" | reference == "2019" | reference == "2020" |
reference == "2021") %>%
mutate(
survey_year_fct = factor(survey_year),
survey_year = as.numeric(survey_year),
botanist_year = str_c(survey_year, botanist, sep = " "),
n = recovery_time
)
rm(list = setdiff(ls(), c("sites")))
m1_flat <- brm(n ~ (target_type + exposition + sand_ratio + survey_year_fct)^4 +
substrate_depth + seed_density +
(1 | site/plot) + (1 | botanist_year),
data = sites,
family = gaussian("identity"),
prior = c(
set_prior("cauchy(0, 1)", class = "sigma")
),
chains = chains,
iter = iter,
thin = thin,
warmup = floor(iter / 2),
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = seed)
### Specifications ###
iter = 10000
chains = 4
thin = 2
seed = 123
priors <- c(
set_prior("normal(0, 2)", class = "b"),
set_prior("normal(0.1, 2)", class = "b", coef = "sand_ratio25"),
set_prior("normal(0.2, 2)", class = "b", coef = "sand_ratio50"),
set_prior("normal(-0.1, 2)", class = "b", coef = "expositionsouth"),
set_prior("normal(0.1, 2)", class = "b", coef = "survey_year_fct2019"),
set_prior("normal(0.2, 2)", class = "b", coef = "survey_year_fct2020"),
set_prior("normal(0.3, 2)", class = "b",coef = "survey_year_fct2021"),
set_prior("cauchy(0, 1)", class = "sigma")
)
m1_flat <- brm(n ~ (target_type + exposition + sand_ratio + survey_year_fct)^4 +
substrate_depth + seed_density +
(1 | site/plot) + (1 | botanist_year),
data = sites,
family = gaussian("identity"),
prior = c(
set_prior("cauchy(0, 1)", class = "sigma")
),
chains = chains,
iter = iter,
thin = thin,
warmup = floor(iter / 2),
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = seed)
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
library(patchwork)
library(brms)
### Start ###
rm(list = ls())
### Load data ###
sites <- read_csv(
here("data", "processed", "data_processed_sites.csv"),
col_names = TRUE, na = c("na", "NA", ""), col_types =
cols(
.default = "?",
plot = "f",
site = "f",
sand_ratio = "f",
substrate_depth = col_factor(levels = c("30", "15")),
target_type = col_factor(levels = c(
"hay_meadow", "dry_grassland"
)),
seed_density = "f",
exposition = col_factor(levels = c(
"north", "south"
)),
survey_year = "c"
)
) %>%
### Exclude data of seed mixtures
filter(survey_year != "seeded") %>%
mutate(
survey_year_fct = factor(survey_year),
botanist_year = str_c(survey_year, botanist, sep = " "),
botanist_year = factor(botanist_year),
n = fcs_target,
id = factor(id)
) %>%
select(
id, plot, site, exposition, sand_ratio, substrate_depth, target_type,
seed_density, survey_year_fct, survey_year, botanist_year, n
)
### Specifications ###
iter = 10000
chains = 4
thin = 2
seed = 123
warmup = floor(iter / 2)
priors <- c(
set_prior("normal(0, 1)", class = "b"),
set_prior("normal(0.1, 1)", class = "b", coef = "sand_ratio25"),
set_prior("normal(0.2, 1)", class = "b", coef = "sand_ratio50"),
set_prior("normal(0.1, 1)", class = "b", coef = "survey_year_fct2019"),
set_prior("normal(0.2, 1)", class = "b", coef = "survey_year_fct2020"),
set_prior("normal(0.3, 1)", class = "b",coef = "survey_year_fct2021"),
set_prior("cauchy(0, 1)", class = "sigma")
)
m2_flat <- brm(n ~ sand_ratio * target_type * exposition * survey_year_fct +
substrate_depth + seed_density +
substrate_depth:exposition +
seed_density:exposition +
substrate_depth:survey_year_fct +
seed_density:survey_year_fct +
botanist_year +
(1 | site/plot),
data = sites,
family = gaussian("identity"),
prior = c(
set_prior("cauchy(0, 1)", class = "sigma")
),
chains = chains,
iter = iter,
thin = thin,
control = list(max_treedepth = 13),
warmup = warmup,
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = seed)
ggplot(data.frame(x = c(-1, 1)), aes(x = x)) +
stat_function(fun = dstudent_t, args = list(df = 3, mu = 0, sigma = 2.5)) +
expand_limits(y = 0) + ggtitle(expression(Student ~ italic(t)"-distribution"))
ggplot(data = data.frame(x = c(-1, 1)), aes(x = x)) +
stat_function(fun = dnorm, n = 101, args = list(mean = 0.1, sd = 1)) +
expand_limits(y = 0) + ggtitle("Normal distribution")
ggplot(data = data.frame(x = c(-1, 1)), aes(x = x)) +
stat_function(fun = dcauchy, n = 101, args = list(location = 0, scale = 1)) +
expand_limits(y = 0) + ggtitle("Cauchy distribution")
ggplot(data.frame(x = c(-1, 1)), aes(x = x)) +
stat_function(fun = dstudent_t, args = list(df = 3, mu = 0, sigma = 2.5)) +
expand_limits(y = 0) + ggtitle(expression(Student ~ italic(t)"-distribution"))
ggplot(data.frame(x = c(-1, 1)), aes(x = x)) +
stat_function(fun = dstudent_t, args = list(df = 3, mu = 0, sigma = 2.5)) +
expand_limits(y = 0) + ggtitle(expression(Student ~ italic(t) * "-distribution"))
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
library(patchwork)
library(brms)
### Start ###
rm(list = ls())
### Load data ###
sites <- read_csv(
here("data", "processed", "data_processed_sites.csv"),
col_names = TRUE, na = c("na", "NA", ""), col_types =
cols(
.default = "?",
plot = "f",
site = "f",
sand_ratio = "f",
substrate_depth = col_factor(levels = c("30", "15")),
target_type = col_factor(levels = c("hay_meadow", "dry_grassland")),
seed_density = "f",
exposition = col_factor(levels = c("north", "south")),
survey_year = "c"
)
) %>%
### Exclude data of seed mixtures
filter(survey_year != "seeded") %>%
mutate(
survey_year_fct = factor(survey_year),
botanist_year = str_c(survey_year, botanist, sep = " "),
botanist_year = factor(botanist_year),
n = fcs_target,
id = factor(id)
) %>%
select(
id, plot, site, exposition, sand_ratio, substrate_depth, target_type,
seed_density, survey_year_fct, survey_year, botanist_year, n
)
m2_flat <- brm(
n ~ sand_ratio * target_type * exposition * survey_year_fct +
substrate_depth + seed_density +
substrate_depth:exposition +
seed_density:exposition +
substrate_depth:survey_year_fct +
seed_density:survey_year_fct +
botanist_year + (1 | site/plot),
data = sites,
family = gaussian("identity"),
prior = c(
set_prior("cauchy(0, 1)", class = "sigma")
),
chains = chains,
iter = iter,
thin = thin,
control = list(max_treedepth = 13),
warmup = warmup,
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = seed
)
### Model specifications ###
iter = 10000
chains = 4
thin = 2
seed = 123
warmup = floor(iter / 2)
priors <- c(
set_prior("normal(0, 1)", class = "b"),
set_prior("normal(0.1, 1)", class = "b", coef = "sand_ratio25"),
set_prior("normal(0.2, 1)", class = "b", coef = "sand_ratio50"),
set_prior("normal(0.1, 1)", class = "b", coef = "survey_year_fct2019"),
set_prior("normal(0.2, 1)", class = "b", coef = "survey_year_fct2020"),
set_prior("normal(0.3, 1)", class = "b",coef = "survey_year_fct2021"),
set_prior("cauchy(0, 1)", class = "sigma")
)
m2_flat <- brm(
n ~ sand_ratio * target_type * exposition * survey_year_fct +
substrate_depth + seed_density +
substrate_depth:exposition +
seed_density:exposition +
substrate_depth:survey_year_fct +
seed_density:survey_year_fct +
botanist_year + (1 | site/plot),
data = sites,
family = gaussian("identity"),
prior = c(
set_prior("cauchy(0, 1)", class = "sigma")
),
chains = chains,
iter = iter,
thin = thin,
control = list(max_treedepth = 13),
warmup = warmup,
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = seed
)
m2_flat <- brm(
n ~ sand_ratio * target_type * exposition * survey_year_fct +
substrate_depth + seed_density +
substrate_depth:exposition +
seed_density:exposition +
substrate_depth:survey_year_fct +
seed_density:survey_year_fct +
botanist_year + (1 | site/plot),
data = sites,
family = gaussian("identity"),
prior = c(
set_prior("cauchy(0, 1)", class = "sigma")
),
chains = chains,
iter = iter,
thin = thin,
control = list(max_treedepth = 13),
warmup = warmup,
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = seed
)
### Packages ###
library(here)
library(tidyverse)
suppressPackageStartupMessages(library(brms))
suppressPackageStartupMessages(library(tidybayes))
library(ggbeeswarm)
### Start ###
rm(list = setdiff(ls(), c("graph_a", "graph_b", "graph_c", "graph_d")))
setwd(here("data", "processed"))
### Load data ###
sites <- read_csv(here("data", "processed", "data_processed_sites.csv"),
col_names = TRUE, na = c("na", "NA", ""), col_types =
cols(
.default = "?",
plot = "f",
site = "f",
sand_ratio = "f",
substrate_depth = col_factor(levels = c("30", "15")),
target_type = col_factor(levels = c(
"hay_meadow", "dry_grassland"
)),
seed_density = "f",
exposition = col_factor(levels = c(
"north", "south"
)),
survey_year = "c"
)) %>%
filter(survey_year != "seeded") %>%
mutate(
n = fcs_target,
survey_year_fct = factor(survey_year),
botanist_year = str_c(survey_year_fct, botanist, sep = " "),
) %>%
select(
id, plot, site, botanist_year, exposition, sand_ratio, substrate_depth,
target_type, seed_density, survey_year_fct, n
)
### * Model ####
load(file = here("outputs", "models", "model_fcs_2.Rdata"))
model <- sites %>%
add_epred_draws(m2, allow_new_levels = TRUE)
### * Functions ####
theme_mb <- function() {
theme(
panel.background = element_rect(fill = "white"),
text = element_text(size = 9, color = "black"),
strip.text = element_text(size = 10),
axis.text = element_text(angle = 0, hjust = 0.5, size = 9,
color = "black"),
axis.title = element_text(angle = 0, hjust = 0.5, size = 9,
color = "black"),
axis.line = element_line(),
legend.key = element_rect(fill = "white"),
legend.text = element_text(size = 9),
legend.position = "right",
legend.margin = margin(0, 0, 0, 0, "cm"),
plot.margin = margin(0, 0, 0, 0, "cm")
)
}
#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# B Plot ######################################################################
#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
## 1 Marginal effects #########################################################
(p1 <- ggplot(data = sites) +
geom_quasirandom(
aes(y = n, x = sand_ratio, color = target_type),
alpha = 0.2,
dodge.width = 0.9,
cex = .5
) +
geom_hline(
yintercept = 0,
linetype = "dashed",
linewidth = .3,
color = "black"
) +
stat_pointinterval(
aes(y = .epred, x = sand_ratio, color = target_type),
data = model,
.width = c(0.66, 0.95),
point_size = 2,
position = "dodge"
) +
facet_grid(
exposition ~ survey_year_fct,
labeller = as_labeller(
c(south = "South", north = "North",
"2018" = "2018", "2019" = "2019", "2020" = "2020", "2021" = "2021")
)
) +
scale_y_continuous(limits = c(-2.8, 2.0), breaks = seq(-100, 400, 1)) +
scale_color_manual(breaks = c("hay_meadow", "dry_grassland"),
labels = c("Hay meadow", "Dry grassland"),
values = c("#00BFC4", "#F8766D")) +
labs(
x = "Sand ratio [%]", color = "", y = expression(
Favourable ~ Conservation ~ Status ~ "(FCS)"
)
) +
theme_mb())
lifecycle::last_lifecycle_warnings()
#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# A Preparation ###############################################################
#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
library(patchwork)
library(brms)
m2_flat <- brm(
n ~ sand_ratio * target_type * exposition * survey_year_fct +
substrate_depth + seed_density +
substrate_depth:exposition +
seed_density:exposition +
substrate_depth:survey_year_fct +
seed_density:survey_year_fct +
botanist_year + (1 | site/plot),
data = sites,
family = gaussian("identity"),
prior = c(
set_prior("cauchy(0, 1)", class = "sigma")
),
chains = chains,
iter = iter,
thin = thin,
control = list(max_treedepth = 13),
warmup = warmup,
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = seed
)
m2_flat <- brm(
n ~ sand_ratio * target_type * exposition * survey_year_fct +
substrate_depth + seed_density +
substrate_depth:exposition +
seed_density:exposition +
substrate_depth:survey_year_fct +
seed_density:survey_year_fct +
botanist_year + (1 | site/plot),
data = sites,
family = gaussian("identity"),
prior = c(
set_prior("cauchy(0, 1)", class = "sigma")
),
chains = chains,
iter = 1000,
thin = thin,
control = list(max_treedepth = 13),
warmup = warmup,
save_pars = save_pars(all = TRUE),
cores = parallel::detectCores(),
seed = seed
)
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
library(patchwork)
library(brms)
### Start ###
rm(list = ls())
### Load data ###
sites <- read_csv(
here("data", "processed", "data_processed_sites.csv"),
col_names = TRUE, na = c("na", "NA", ""), col_types =
cols(
.default = "?",
plot = "f",
site = "f",
sand_ratio = "f",
substrate_depth = col_factor(levels = c("30", "15")),
target_type = col_factor(levels = c("hay_meadow", "dry_grassland")),
seed_density = "f",
exposition = col_factor(levels = c("north", "south")),
survey_year = "c"
)
) %>%
### Exclude data of seed mixtures
filter(survey_year != "seeded") %>%
mutate(
survey_year_fct = factor(survey_year),
botanist_year = str_c(survey_year, botanist, sep = " "),
botanist_year = factor(botanist_year),
n = fcs_target,
id = factor(id)
) %>%
select(
id, plot, site, exposition, sand_ratio, substrate_depth, target_type,
seed_density, survey_year_fct, survey_year, botanist_year, n
)
