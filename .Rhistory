r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_substitution,
sites_seedmix,
adjR2thresh = r2adj,
nperm = 9999)
sites_seedmix_selected <- sites %>%
select()
#### * Exposition ####
m1 <- dbrda(beta_substitution ~ exposition, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_substitution,
sites_space,
#adjR2thresh = r2adj,
nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_space))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
sites_space_selected <- sites %>%
select(exposition_numeric)
m1_substitution_varpart <- varpart(
beta_substitution,
sites_soil_selected, sites_seedmix_selected, sites_space_selected
)
sites_seedmix_selected <- sites %>%
select(seedDensity) # Dummy
m1_substitution_varpart <- varpart(
beta_substitution,
sites_seedmix_selected, sites_space_selected
)
tiff(
here("outputs", "figures", "figure_2018_replacement_800dpi_12x12cm.tiff"),
res = 72, width = 12, height = 12, units = "cm", compression = "none"
)
plot(
m1_substitution_varpart,
Xnames = c("Seedmix", "Exposition"),
cutoff = 0.01, digits = 2, bg = NA
)
dev.off()
m1 <- dbrda(
beta_subsets ~ sandRatio + substrateDepth +
seedDensity + targetType + exposition,
data = sites
)
anova(m1, permutations = how(nperm = 9999)) # P = 1e-04
#### * Soil ####
m1 <- dbrda(
beta_subsets ~ sandRatio + substrateDepth, data = sites
)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_subsets,
sites_soil,
#adjR2thresh = r2adj,
nperm = 9999)
#### * Seedmix ####
m1 <- dbrda(beta_subsets ~ targetType + seedDensity, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_subsets,
sites_seedmix,
#adjR2thresh = r2adj,
nperm = 9999)
sites_seedmix_selected <- sites %>%
select(seedDensity) #Dummy
#### * exposition ####
m1 <- dbrda(beta_subsets ~ exposition, data = sites)
r2adj <- RsquareAdj(m1)$adj.r.squared
sel <- forward.sel(beta_subsets,
sites_space,
adjR2thresh = r2adj,
nperm = 9999)
sel$p_adj <- p.adjust(sel$pvalue, method = "holm", n = ncol(sites_space))
sel # https://www.davidzeleny.net/anadat-r/doku.php/en:forward_sel_examples
sites_space_selected <- sites %>%
select(exposition_numeric)
m1_subsets_varpart <- varpart(
beta_subsets, sites_seedmix_selected, sites_space_selected
)
tiff(
here("outputs", "figures", "figure_2018_nestedness_800dpi_12x12cm.tiff"),
res = 72, width = 12, height = 12, units = "cm", compression = "none"
)
plot(
m1_subsets_varpart,
Xnames = c("Seedmix", "Exposition"),
cutoff = 0.01, digits = 2, bg = NA
)
dev.off()
#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# A Preparation ###############################################################
#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
### Packages ###
library(here)
library(tidyverse)
library(ggbeeswarm)
library(lmerTest)
library(DHARMa)
library(emmeans)
### Start ###
rm(list = ls())
setwd(here("data", "processed"))
### Load data ###
sites <- read_csv2("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA"), col_types =
cols(
.default = "?"
)
)) %>%
mutate(n = cwmAbuSla)
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA"), col_types =
cols(
.default = "?"
)
)) %>%
mutate(n = cwmAbuSla)
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA"), col_types =
cols(
.default = "?"
)
)) #%>%
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA"), col_types =
cols(
.default = "?"
)
) #%>%
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA"), col_types =
cols(
.default = "?"
)
) %>%
mutate(n = cwmAbuSla) %>%
select(id, plot, block, surveyYear, exposition,
sandRatio, substrateDepth, seedDensity, targetType, n)
#### a Graphs -----------------------------------------------------------------
#simple effects:
ggplot(sites, aes(y = n, x = exposition)) +
geom_boxplot() + geom_quasirandom()
ggplot(sites, aes(y = n, x = targetType)) +
geom_point() + geom_quasirandom()
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA"), col_types =
cols(
.default = "?"
)
) %>%
filter(!str_detect(id, "C")) %>%
mutate(n = cwmAbuSla) %>%
select(id, plot, block, surveyYear, exposition,
sandRatio, substrateDepth, seedDensity, targetType, n)
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA"), col_types =
cols(
.default = "?",
exposition = "f",
sandRatio = "f",
substrateDepth = "f",
seedDensity = "f",
targetType = "f"
)
) %>%
filter(!str_detect(id, "C")) %>%
mutate(n = cwmAbuSla) %>%
select(id, plot, block, surveyYear, exposition,
sandRatio, substrateDepth, seedDensity, targetType, n)
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA"), col_types =
cols(
.default = "?",
block = "f",
exposition = "f",
sandRatio = "f",
substrateDepth = "f",
seedDensity = "f",
targetType = "f"
)
) %>%
filter(!str_detect(id, "C")) %>%
mutate(n = cwmAbuSla) %>%
select(id, plot, block, surveyYear, exposition,
sandRatio, substrateDepth, seedDensity, targetType, n)
#### a Graphs -----------------------------------------------------------------
#simple effects:
ggplot(sites, aes(y = n, x = exposition)) +
geom_boxplot() + geom_quasirandom()
ggplot(sites, aes(y = n, x = targetType)) +
geom_point() + geom_quasirandom()
ggplot(sites, aes(y = n, x = targetType)) +
geom_boxplot() + geom_quasirandom()
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA"), col_types =
cols(
.default = "?",
block = "f",
exposition = "f",
sandRatio = "f",
substrateDepth = "f",
seedDensity = "f",
targetType = "f"
)
) %>%
filter(!str_detect(id, "C")) %>%
mutate(n = cwmAbuSla) #%>%
select(id, plot, block, surveyYear, exposition,
sandRatio, substrateDepth, seedDensity, targetType, n)
View(sites)
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA"), col_types =
cols(
.default = "?",
block = "f",
exposition = "f",
sandRatio = "f",
substrateDepth = "f",
seedDensity = "f",
targetType = "f"
)
) %>%
filter(!str_detect(id, "C")) %>%
mutate(n = cwmAbuSla) %>%
select(id, plot, block, surveyYear, exposition,
sandRatio, substrateDepth, seedDensity, targetType, n)
ggplot(sites, aes(y = n, x = seedDensity)) +
geom_boxplot() + geom_quasirandom()
ggplot(sites, aes(y = n, x = substrateDepth)) +
geom_boxplot() + geom_quasirandom()
ggplot(sites, aes(y = n, x = sandRatio)) +
geom_boxplot() + geom_quasirandom()
ggplot(sites, aes(y = n, x = block)) +
geom_boxplot() + geom_quasirandom()
#2way
ggplot(sites, aes(x = exposition, y = n, color = targetType)) +
geom_boxplot() + geom_quasirandom()
#2way
ggplot(sites, aes(x = targetType, y = n)) +
geom_boxplot() + geom_quasirandom() + facet_wrap(~ exposition)
#2way
ggplot(sites, aes(x = exposition, y = n)) +
geom_boxplot() + geom_quasirandom() + facet_wrap(~ targetType)
ggplot(sites, aes(x = targetType, y = n)) +
geom_boxplot() + geom_quasirandom() + facet_wrap(~ seedDensity)
ggplot(sites, aes(x = targetType, y = n)) +
geom_boxplot() + geom_quasirandom() + facet_wrap(~ sandRatio)
ggplot(sites, aes(x = sandRatio, y = n)) +
geom_boxplot() + geom_quasirandom() + facet_wrap(~ targetType)
ggplot(sites, aes(x = substrateDepth, y = n)) +
geom_boxplot() + geom_quasirandom() + facet_wrap(~ targetType)
#3way
ggplot(sites, aes(x = exposition, y = n, color = sandRatio)) +
geom_boxplot() + facet_wrap(~ targetType)
ggplot(sites, aes(x = exposition, y = n, color = substrateDepth)) +
geom_boxplot() + facet_wrap(~ targetType)
ggplot(sites, aes(x = targetType, y = n)) +
geom_boxplot() + geom_quasirandom() + facet_wrap(~ substrateDepth)
ggplot(sites, aes(x = sandRatio, y = n, color = substrateDepth)) +
geom_boxplot() + facet_wrap(~ targetType)
ggplot(sites, aes(x = substrateDepth, y = n, color = sandRatio)) +
geom_boxplot() + facet_wrap(~ targetType)
#3way
ggplot(sites, aes(x = exposition, y = n, color = sandRatio)) +
geom_boxplot() + facet_wrap(~ targetType)
#4way
ggplot(sites, aes(x = exposition, y = n, color = sandRatio, fill = substrateDepth)) +
geom_boxplot() + facet_wrap(~ targetType)
#4way
ggplot(sites, aes(x = exposition, y = n)) +
geom_point(aes(color = sandRatio)) +
geom_line(aes(group = sandRatio:substrateDepth,
color = sandRatio,
linetype = substrateDepth),
size = 1) +
facet_wrap(~ targetType)
#4way
ggplot(sites, aes(x = exposition, y = n)) +
geom_boxplot(aes(color = sandRatio)) +
geom_line(aes(group = sandRatio:substrateDepth,
color = sandRatio,
linetype = substrateDepth),
size = 1) +
facet_wrap(~ targetType)
#4way
ggplot(sites, aes(x = exposition, y = n, color = sandRatio, fill = substrateDepth)) +
geom_boxplot() + facet_wrap(~ targetType)
#2way
ggplot(sites, aes(x = exposition, y = n)) +
geom_boxplot() + geom_quasirandom() + facet_wrap(~ targetType)
ggplot(sites, aes(x = sandRatio, y = n)) +
geom_boxplot() + geom_quasirandom() + facet_wrap(~ targetType)
#3way
ggplot(sites, aes(x = exposition, y = n, color = sandRatio)) +
geom_boxplot() + facet_wrap(~ targetType)
#3way
ggplot(sites %>% filter(surveyYear == 2021), aes(x = exposition, y = n, color = sandRatio)) +
geom_boxplot() + facet_wrap(~ targetType)
##### b Outliers, zero-inflation, transformations? ----------------------------
dotchart((sites$n), groups = factor(sites$exposition),
main = "Cleveland dotplot")
sites %>% count(locationAbb)
sites %>% count(block)
boxplot(sites$n)
plot(table((sites$n)), type = "h",
xlab = "Observed values", ylab = "Frequency")
ggplot(sites, aes(n)) + geom_density()
ggplot(sites, aes(sqrt(n))) + geom_density()
ggplot(sites, aes(log(n))) + geom_density()
#### a models -----------------------------------------------------------------
#random structure
m1a <- lmer(n ~ 1 + (surveyYear | block/plot), sites, REML = FALSE)
m1b <- lmer(n ~ 1 + (surveyYear | block), sites, REML = FALSE)
VarCorr(m1b) # convergence problems
m1c <- lmer(n ~ 1 + (1 | block/plot), sites, REML = FALSE)
VarCorr(m1c)
m1d <- lmer(n ~ 1 + (1 | plot), sites, REML = FALSE)
VarCorr(m1d)
m1d <- lmer(n ~ 1 + (1 | block/substrateDepth/plot), sites, REML = FALSE)
m1d <- lmer(n ~ substrateDepth + (1 | block/substrateDepth/plot), sites, REML = FALSE)
m1d <- lmer(n ~ sandRatio + (1 | block/sandRatio/plot), sites, REML = FALSE)
m1d <- lmer(n ~ 1 + (1 | block/plot), sites, REML = FALSE)
VarCorr(m1d)
#fixed effects
m2 <- lmer((n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity + factor(surveyYear))^3 +
(1 | block/plot), sites, REML = FALSE)
simulateResiduals(m2, plot = TRUE)
### Model output -------------------------------------------------------------
MuMIn::r.squaredGLMM(m2)
car::Anova(m2, type = 2)
car::Anova(m2, type = 3)
ggplot(sites, aes(x = surveyYear, y = n, color = sandRatio)) +
geom_boxplot() + facet_wrap(~ targetType)
ggplot(sites, aes(x = factor(surveyYear), y = n, color = sandRatio)) +
geom_boxplot() + facet_wrap(~ targetType)
ggplot(sites, aes(x = factor(surveyYear), y = n, color = sandRatio)) +
geom_boxplot() + facet_wrap(~ substrateDepth)
ggplot(sites, aes(x = factor(surveyYear), y = n, color = exposition)) +
geom_boxplot() + facet_wrap(~ targetType)
ggplot(sites, aes(x = factor(surveyYear), y = n, color = targetType)) +
geom_boxplot() + facet_wrap(~ exposition)
#fixed effects
m2 <- lmer((n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity + factor(surveyYear)) +
exposition:factor(surveyYear) + exposition:sandRatio +
exposition:targetType +
(1 | block/plot), sites, REML = FALSE)
simulateResiduals(m2, plot = TRUE)
#fixed effects
m2 <- lmer(log(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity + factor(surveyYear)) +
exposition:factor(surveyYear) + exposition:sandRatio +
exposition:targetType +
(1 | block/plot), sites, REML = FALSE)
simulateResiduals(m2, plot = TRUE)
#fixed effects
m2 <- lmer(sqrt(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity + factor(surveyYear)) +
exposition:factor(surveyYear) + exposition:sandRatio +
exposition:targetType +
(1 | block/plot), sites, REML = FALSE)
simulateResiduals(m2, plot = TRUE)
#fixed effects
m2 <- lmer(sqrt(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity + factor(surveyYear)) +
exposition:factor(surveyYear) + exposition:sandRatio +
exposition:targetType +
(1 | block/sandRatio/plot), sites, REML = FALSE)
simulateResiduals(m2, plot = TRUE)
#fixed effects
m2 <- lmer(sqrt(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity + factor(surveyYear)) +
exposition:factor(surveyYear) + exposition:sandRatio +
exposition:targetType +
(1 | block/sandRatio:substrateDepth/plot), sites, REML = FALSE)
simulateResiduals(m2, plot = TRUE)
#fixed effects
m2 <- lmer(sqrt(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity) +
exposition:sandRatio +
exposition:targetType +
(1 | block/plot) + (1 | factor(surveyYear)), sites, REML = FALSE)
#fixed effects
m2 <- lmer(sqrt(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity) +
exposition:sandRatio +
exposition:targetType +
(1 | block/plot) + (1 | factor(sites$surveyYear)), sites, REML = FALSE)
simulateResiduals(m2, plot = TRUE)
### Model output -------------------------------------------------------------
MuMIn::r.squaredGLMM(m2)
car::Anova(m2, type = 3)
ggplot(sites, aes(x = sandRatio, y = n)) +
geom_boxplot() + geom_quasirandom() + facet_wrap(~ exposition)
#fixed effects
m2 <- lmer(sqrt(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity) +
exposition:sandRatio + exposition:targetType +
(1 | block/plot) + (1 | factor(surveyYear)), sites, REML = FALSE)
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA"), col_types =
cols(
.default = "?",
block = "f",
exposition = "f",
sandRatio = "f",
substrateDepth = "f",
seedDensity = "f",
targetType = "f"
)
) %>%
filter(!str_detect(id, "C")) %>%
mutate(n = cwmAbuSla,
surveyYear_fac = factor(surveyYear)) %>%
select(id, plot, block, surveyYear, exposition,
sandRatio, substrateDepth, seedDensity, targetType, n)
#fixed effects
m2 <- lmer(sqrt(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity) +
exposition:sandRatio + exposition:targetType +
(1 | block/plot) + (1 | surveyYear_fac), sites, REML = FALSE)
### Load data ###
sites <- read_csv("data_processed_sites.csv",
col_names = TRUE, na = c("na", "NA"), col_types =
cols(
.default = "?",
block = "f",
exposition = "f",
sandRatio = "f",
substrateDepth = "f",
seedDensity = "f",
targetType = "f"
)
) %>%
filter(!str_detect(id, "C")) %>%
mutate(n = cwmAbuSla,
surveyYear_fac = factor(surveyYear)) %>%
select(id, plot, block, surveyYear, surveyYear_fac, exposition,
sandRatio, substrateDepth, seedDensity, targetType, n)
#fixed effects
m2 <- lmer(sqrt(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity) +
exposition:sandRatio + exposition:targetType +
(1 | block/plot) + (1 | surveyYear_fac), sites, REML = FALSE)
simulateResiduals(m2, plot = TRUE)
### Model output -------------------------------------------------------------
MuMIn::r.squaredGLMM(m2)
car::Anova(m2, type = 3)
#fixed effects
m2 <- lmer((n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity) +
exposition:sandRatio + exposition:targetType +
(1 | block/plot) + (1 | surveyYear_fac), sites, REML = FALSE)
simulateResiduals(m2, plot = TRUE)
### Model output -------------------------------------------------------------
MuMIn::r.squaredGLMM(m2)
#fixed and site and year effects
m3 <- lmer((n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity) + surveyYear_fac +
exposition:sandRatio + exposition:targetType +
(1 | block/plot), sites, REML = FALSE)
simulateResiduals(m3, plot = TRUE)
#fixed and site and year effects
m3 <- lmer(log(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity) + surveyYear_fac +
exposition:sandRatio + exposition:targetType +
(1 | block/plot), sites, REML = FALSE)
simulateResiduals(m3, plot = TRUE)
#fixed and site and year effects
m3 <- lmer(sqrt(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity) + surveyYear_fac +
exposition:sandRatio + exposition:targetType +
(1 | block/plot), sites, REML = FALSE)
simulateResiduals(m3, plot = TRUE)
m4 <- lmer(sqrt(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity + surveyYear_fac)^2 +
(1 | block/plot), sites, REML = FALSE)
simulateResiduals(m4, plot = TRUE)
m4 <- lmer(sqrt(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity)^2 + surveyYear_fac +
(1 | block/plot), sites, REML = FALSE)
simulateResiduals(m4, plot = TRUE)
### Model output -------------------------------------------------------------
MuMIn::r.squaredGLMM(m4)
m4 <- lmer(sqrt(n) ~ (exposition + substrateDepth + sandRatio + targetType +
seedDensity + surveyYear_fac)^3 +
(1 | block/plot), sites, REML = FALSE)
simulateResiduals(m4, plot = TRUE)
ggplot(sites %>% filter(surveyYear == 2021, aes(y = n, x = targetType)) +
ggplot(sites %>% filter(surveyYear == 2021, aes(y = n, x = targetType)) +
ggplot(sites %>% filter(surveyYear == 2021), aes(y = n, x = targetType)) +
geom_boxplot() + geom_quasirandom()
ggplot(sites %>% filter(surveyYear == 2021), aes(y = n, x = targetType)) +
geom_boxplot() + geom_quasirandom()
#2way
ggplot(sites %>% filter(surveyYear == 2021), aes(x = exposition, y = n)) +
geom_boxplot() + geom_quasirandom() + facet_wrap(~ targetType)
ggplot(sites %>% filter(surveyYear == 2021), aes(x = sandRatio, y = n)) +
geom_boxplot() + geom_quasirandom() + facet_wrap(~ targetType)
ggplot(sites %>% filter(surveyYear == 2021),
aes(x = exposition, y = n, color = sandRatio)) +
geom_boxplot() + facet_wrap(~ targetType)
library(brms)
install.packages("brms")
