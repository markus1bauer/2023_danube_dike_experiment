ungroup() %>%
pivot_longer(starts_with("20"), names_to = "surveyYear", values_to = "value",
names_transform = list(surveyYear = as.factor)) %>%
mutate(successCov = if_else(seeded > 0 & value > 0, 1, 0)) %>%
group_by(plot, surveyYear) %>%
summarise(seededRichness = sum(successCov), .groups = "keep") %>%
ungroup() %>%
unite(id, plot, surveyYear, sep = "_")
### * ffh6510 species (species richness) ####
speciesRichness_ffh6510 <- speciesRichness %>%
filter(ffh6510 == "yes") %>%
summarise(ffh6510Richness = sum(n, na.rm = T)) %>%
ungroup()
### * ffh6210 species (species richness) ####
speciesRichness_ffh6210 <- speciesRichness %>%
filter(ffh6210 == "yes") %>%
summarise(ffh6210Richness = sum(n, na.rm = T)) %>%
ungroup()
### * implement in sites data set ####
sites <- sites %>%
left_join(speciesRichness_all, by = "id") %>%
left_join(speciesRichness_rlg, by = "id") %>%
left_join(speciesRichness_rlb, by = "id") %>%
left_join(speciesRichness_target, by = "id") %>%
left_join(speciesRichness_seeded, by = "id") %>%
left_join(speciesRichness_ffh6510, by = "id") %>%
left_join(speciesRichness_ffh6210, by = "id") %>%
### Create targetRichratio ###
mutate(targetRichratio = targetRichness / speciesRichness,
seededRichratio = seededRichness / speciesRichness,
targetRichratio = round(targetRichratio, 3),
seededRichratio = round(seededRichratio, 3))
### b Species eveness and shannon ----------------------------------------------------------------------
data <- species  %>%
mutate(across(where(is.numeric), ~replace(., is.na(.), 0))) %>%
pivot_longer(-name, names_to = "id", values_to = "value") %>%
pivot_wider(names_from = "name", values_from = "value") %>%
column_to_rownames("id") %>%
diversity(index = "shannon") %>%
as_tibble(rownames = NA) %>%
rownames_to_column(var = "id") %>%
mutate(id = factor(id)) %>%
rename(shannon = value)
sites <- sites %>%
left_join(data, by = "id") %>%
mutate(eveness = shannon / log(speciesRichness))
rm(list = ls(pattern = "[^species|traits|sites]"))
## 5 CWM of Ellenberg #####################################################################################
### a N value -------------------------------------------------------------------------------------------
data_traits <- traits %>%
select(name, n) %>%
filter(n > 0)
data_species <- semi_join(species, data_traits, by = "name") %>%
pivot_longer(-name, names_to = "id", values_to = "value") %>%
group_by(id) %>%
mutate(sum = sum(value, na.rm = T)) %>%
filter(sum > 0) %>%
select(-sum) %>%
pivot_wider(names_from = "name", values_from = "value") %>%
column_to_rownames("id")
data_traits <- column_to_rownames(data_traits, "name")
### Calculate CWM ###
Nweighted <- dbFD(data_traits, data_species, w.abun = T,
calc.FRic = F, calc.FDiv = F, corr = "sqrt")
### b F value -------------------------------------------------------------------------------------------
data_traits <- traits %>%
select(name, f) %>%
filter(f > 0)
data_species <- semi_join(species, data_traits, by = "name") %>%
pivot_longer(-name, names_to = "id", values_to = "value") %>%
group_by(id) %>%
mutate(sum = sum(value, na.rm = T)) %>%
filter(sum > 0) %>%
select(-sum) %>%
pivot_wider(names_from = "name", values_from = "value") %>%
column_to_rownames("id")
data_traits <- column_to_rownames(data_traits, "name")
### Calculate CWM ###
Fweighted <- dbFD(data_traits, data_species, w.abun = T,
calc.FRic = F, calc.FDiv = F, corr = "sqrt")
### c T value -------------------------------------------------------------------------------------------
data_traits <- traits %>%
select(name, t) %>%
filter(t > 0)
data_species <- semi_join(species, data_traits, by = "name") %>%
pivot_longer(-name, names_to = "id", values_to = "value") %>%
group_by(id) %>%
mutate(sum = sum(value, na.rm = T)) %>%
filter(sum > 0) %>%
select(-sum) %>%
pivot_wider(names_from = "name", values_from = "value") %>%
column_to_rownames("id")
data_traits <- column_to_rownames(data_traits, "name")
### Calculate CWM ###
